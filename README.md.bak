<div align="center">

# üå≥ Creative Trees

### Enterprise-Grade Laravel 12 Admin System with AI Intelligence & Tamper-Evident Audit Logging

[![Laravel](https://img.shields.io/badge/Laravel-12.x-FF2D20?style=for-the-badge&logo=laravel&logoColor=white)](https://laravel.com)
[![Filament](https://img.shields.io/badge/Filament-4.x-FDAE4B?style=for-the-badge&logo=laravel&logoColor=white)](https://filamentphp.com)
[![PHP](https://img.shields.io/badge/PHP-8.4-777BB4?style=for-the-badge&logo=php&logoColor=white)](https://php.net)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?style=for-the-badge&logo=mysql&logoColor=white)](https://www.mysql.com)
[![Redis](https://img.shields.io/badge/Redis-7.0-DC382D?style=for-the-badge&logo=redis&logoColor=white)](https://redis.io)
[![Docker](https://img.shields.io/badge/Docker-Ready-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://docker.com)

[![Version](https://img.shields.io/badge/Version-1.2.8-0066CC?style=for-the-badge)](https://github.com/Halfirzzha/A-Good-Start-to-the-Program/releases)
[![Security](https://img.shields.io/badge/Security-9%2F10-00C853?style=for-the-badge&logo=shield)](#-security-hardening)
[![AI Providers](https://img.shields.io/badge/AI_Providers-9-8E24AA?style=for-the-badge&logo=openai)](#-ai-intelligence-orchestration)
[![Tests](https://img.shields.io/badge/Tests-Passing-00C853?style=for-the-badge&logo=github-actions)](https://github.com/Halfirzzha/A-Good-Start-to-the-Program/actions)
[![License](https://img.shields.io/badge/License-MIT-16A34A?style=for-the-badge)](LICENSE)
[![PRs Welcome](https://img.shields.io/badge/PRs-Welcome-00C853?style=for-the-badge)](https://github.com/Halfirzzha/A-Good-Start-to-the-Program/pulls)

**Production-ready Laravel admin system with 9-provider AI orchestration, cryptographic audit integrity, enterprise security controls, and compliance-ready governance designed for universities, government agencies, and large organizations.**

---

### üéØ Value Proposition

```
‚úÖ Zero to Production in 10 Minutes  |  üîê 9/10 Security Hardening  |  ü§ñ 9 AI Providers with Failover
üìä SHA-256 Tamper-Evident Audit  |  üë• 5-Level RBAC System  |  üê≥ 16-Service Docker Stack
```

### üìå Quick Navigation

[Overview](#-overview) ‚Ä¢ [Features](#-key-features) ‚Ä¢ [Installation](#-installation-guide) ‚Ä¢ [Docker Setup](#-docker-enterprise-setup) ‚Ä¢ [Architecture](#-architecture--design) ‚Ä¢ [Security](#-security-hardening) ‚Ä¢ [AI](#-ai-intelligence-orchestration) ‚Ä¢ [Operations](#-operations--maintenance) ‚Ä¢ [Troubleshooting](#-troubleshooting) ‚Ä¢ [FAQ](#-faq)

</div>

---

## üìë Table of Contents

- [üéØ Overview](#-overview)
- [üíé Key Features](#-key-features)
- [üìã System Requirements](#-system-requirements)
- [üì¶ Installation Guide](#-installation-guide)
    - [üåü Step 0: Complete Beginner Installation (Start from Zero)](#-step-0-complete-beginner-installation-start-from-zero)
    - [Prerequisites Check](#prerequisites-check)
    - [üê≥ Docker Enterprise Setup (Recommended)](#-docker-enterprise-setup-recommended)
    - [Docker Installation by Operating System](#docker-installation-by-operating-system)
    - [Quick Start with Docker](#quick-start-with-docker)
    - [‚öì Laravel Sail Installation](#-laravel-sail-installation)
    - [üîß Manual Installation (Non-Docker)](#-manual-installation-non-docker)
    - [üåê Shared Hosting Deployment](#-shared-hosting-deployment)
    - [‚òÅÔ∏è VPS/Production Server Setup](#Ô∏è-vpsproduction-server-setup)
- [üìã Docker Commands Reference](#-docker-commands-reference)
- [üèóÔ∏è Architecture & Design](#Ô∏è-architecture--design)
- [üîí Security Hardening](#-security-hardening)
- [ü§ñ AI Intelligence Orchestration](#-ai-intelligence-orchestration)
- [‚öôÔ∏è Configuration](#Ô∏è-configuration)
- [üöÄ Operations & Maintenance](#-operations--maintenance)
- [‚ö° Performance & Optimization](#-performance--optimization)
- [üß™ Testing & Quality Assurance](#-testing--quality-assurance)
- [üì° API Documentation](#-api-documentation)
- [üö¢ Deployment Strategies](#-deployment-strategies)
- [üìä Monitoring & Alerting](#-monitoring--alerting)
- [üíæ Backup & Disaster Recovery](#-backup--disaster-recovery)
- [üîß Troubleshooting](#-troubleshooting)
- [‚ùì FAQ](#-faq)
- [üìñ Code Examples & Best Practices](#-code-examples--best-practices)
- [üîÑ Migration & Upgrade Guide](#-migration--upgrade-guide)
- [üë• Development Workflow](#-development-workflow)
- [üìù Changelog](#-changelog)
- [ü§ù Contributing](#-contributing)
- [üìÑ License](#-license)

---

## üéØ Overview

**Creative Trees** is a battle-tested, enterprise-grade Laravel 12 + Filament v4 administrative system designed for organizations that demand uncompromising security, auditability, and operational excellence. Built from the ground up with compliance, scalability, and developer experience in mind.

### üé™ Core Differentiators

| Capability                             | Description                                      | Business Value                                   |
| -------------------------------------- | ------------------------------------------------ | ------------------------------------------------ |
| **üîê Cryptographic Audit Integrity**   | SHA-256 hash chain with tamper detection         | Compliance with SOX, GDPR, ISO 27001             |
| **ü§ñ Multi-Provider AI Orchestration** | 9 AI providers with automatic failover           | 99.9% AI service availability, cost optimization |
| **üëÆ Enterprise Security Controls**    | 5-level RBAC, session tracking, threat detection | Meet security standards for government/banking   |
| **üê≥ Production-Ready Docker Stack**   | 16-service containerized architecture            | Deploy anywhere in <10 minutes                   |
| **üìä Full Observability**              | Prometheus + Grafana monitoring                  | Real-time performance insights                   |
| **üîî Multi-Channel Notifications**     | Email, SMS, Push, Webhook with delivery tracking | Guaranteed message delivery                      |

### üéØ Target Audience

| Organization Type               | Primary Use Cases                                               | Key Benefits                                |
| ------------------------------- | --------------------------------------------------------------- | ------------------------------------------- |
| **üéì Universities & Education** | Student information systems, faculty management, grade tracking | FERPA compliance, audit trails              |
| **üè¢ Large Enterprises**        | Internal admin portals, employee management, approval workflows | SOX compliance, role segregation            |
| **üèõÔ∏è Government Agencies**      | Citizen services, document management, inter-agency systems     | Security clearance levels, audit logs       |
| **üè¶ Financial Institutions**   | Back-office operations, compliance reporting, user provisioning | PCI-DSS ready, tamper-evident logs          |
| **üöÄ Scale-ups & Startups**     | Admin dashboards, SaaS backends, internal tools                 | Rapid deployment, future-proof architecture |

### üèÜ Why Creative Trees?

**Compared to building from scratch:**

- ‚úÖ Save 3-6 months of development time
- ‚úÖ Battle-tested security patterns included
- ‚úÖ Enterprise-grade audit logging out-of-the-box
- ‚úÖ Multi-provider AI ready on day one
- ‚úÖ Docker production stack pre-configured

**Compared to other admin panels:**

- ‚úÖ Cryptographic audit integrity (SHA-256 hash chains)
- ‚úÖ 9 AI providers with automatic failover
- ‚úÖ Full observability stack (Prometheus + Grafana)
- ‚úÖ Security threat detection and rate limiting
- ‚úÖ Multi-channel notification delivery tracking

---

## ÔøΩ Key Features

### üîê Security & Compliance

| Feature                          | Implementation                                                                     | Compliance Standards                             |
| -------------------------------- | ---------------------------------------------------------------------------------- | ------------------------------------------------ |
| **Tamper-Evident Audit Logging** | SHA-256 hash chain with automatic integrity verification                           | SOX, GDPR Article 5, ISO 27001, HIPAA            |
| **5-Level Role Hierarchy**       | Super Admin ‚Üí Admin ‚Üí Manager ‚Üí Supervisor ‚Üí User                                  | RBAC best practices, SOD (Segregation of Duties) |
| **Password Security**            | 12+ chars, complexity rules, history tracking (5 passwords), HIBP breach detection | NIST 800-63B, PCI-DSS 8.2.3                      |
| **Session Management**           | Device fingerprinting, concurrent session limits, session stamping                 | OWASP Session Management Cheat Sheet             |
| **Threat Detection**             | Adaptive risk scoring, automatic IP blocking, suspicious pattern detection         | OWASP Top 10 mitigation                          |
| **Security Headers**             | CSP, HSTS, X-Frame-Options, X-Content-Type-Options                                 | OWASP Secure Headers Project                     |
| **Rate Limiting**                | Configurable throttling per route/IP with Redis backing                            | DDoS protection, API abuse prevention            |

### ü§ñ AI Intelligence Platform

| Provider        | Models Available                                 | Latency | Cost Tier | Use Case                                      |
| --------------- | ------------------------------------------------ | ------- | --------- | --------------------------------------------- |
| **OpenAI**      | GPT-4o, GPT-4o-mini, GPT-3.5-turbo               | ~500ms  | Premium   | High-quality general purpose                  |
| **Anthropic**   | Claude 3.5 Sonnet, Claude 3 Opus, Claude 3 Haiku | ~400ms  | Premium   | Complex reasoning, long context (200K tokens) |
| **Google**      | Gemini Pro 1.5, Gemini Flash                     | ~300ms  | Mid       | Multimodal, fast responses, free tier         |
| **Groq**        | Llama 3.1, Mixtral 8x7B                          | ~50ms   | Low       | Ultra-fast inference (500+ tokens/sec)        |
| **DeepSeek**    | DeepSeek Chat, DeepSeek Coder                    | ~350ms  | Budget    | Cost-effective ($0.14/M tokens)               |
| **Mistral**     | Mistral Large 2, Mistral Medium                  | ~400ms  | Mid       | European GDPR compliance                      |
| **OpenRouter**  | 100+ aggregated models                           | ~600ms  | Variable  | Model diversity, fallback routing             |
| **Cohere**      | Command R+, Command R                            | ~450ms  | Mid       | Enterprise embeddings, RAG                    |
| **Together AI** | 50+ open-source models                           | ~300ms  | Low       | Self-hostable model access                    |

**Smart Features:**

- ‚úÖ Automatic failover cascading (Primary ‚Üí Secondary ‚Üí Tertiary)
- ‚úÖ Cost optimization routing (cheap models for simple tasks)
- ‚úÖ Latency-based selection for real-time applications
- ‚úÖ Usage analytics and cost tracking per provider
- ‚úÖ Token limit management and streaming support

### üìä Audit & Observability

| Component              | Technology                           | Purpose                                        |
| ---------------------- | ------------------------------------ | ---------------------------------------------- |
| **Audit Logging**      | Custom SHA-256 chain                 | Immutable event tracking with tamper detection |
| **Metrics Collection** | Prometheus + Exporters               | MySQL, Redis, container, host metrics          |
| **Visualization**      | Grafana pre-configured dashboards    | Real-time performance monitoring               |
| **Alerting**           | Alertmanager                         | Slack/Email/PagerDuty integration              |
| **Log Aggregation**    | Laravel logging stack                | Centralized application logs                   |
| **Health Checks**      | Laravel Health + Docker healthchecks | Service availability monitoring                |

### üîî Multi-Channel Notifications

| Channel                | Provider              | Delivery Tracking                 | Retry Logic                         |
| ---------------------- | --------------------- | --------------------------------- | ----------------------------------- |
| **Email**              | SMTP / Mailgun / SES  | ‚úÖ Read receipts, bounce handling | 3 attempts with exponential backoff |
| **SMS**                | Twilio / Vonage / SNS | ‚úÖ Delivery confirmation          | 2 attempts within 1 hour            |
| **Push Notifications** | FCM / APNs            | ‚úÖ Device token validation        | 1 attempt, queue for retry          |
| **Webhooks**           | HTTP POST             | ‚úÖ Response code tracking         | 5 attempts over 24 hours            |

**Notification Features:**

- üìß Template management with variable substitution
- üéØ User-level channel preferences
- üìä Delivery analytics and failure tracking
- üîÑ Automatic failover to alternative channels
- üìÖ Scheduled delivery and timezone handling

### üê≥ Docker Enterprise Stack

| Service            | Image                           | Purpose                                      | Exposed Port |
| ------------------ | ------------------------------- | -------------------------------------------- | ------------ |
| **app**            | php:8.4-fpm (custom)            | Laravel application container                | -            |
| **web**            | nginx:1.27-alpine               | Reverse proxy with security headers          | 8080         |
| **queue**          | php:8.4-fpm                     | Laravel queue worker (Redis-backed)          | -            |
| **scheduler**      | php:8.4-fpm                     | Laravel task scheduler (cron)                | -            |
| **node**           | node:20-alpine                  | Vite dev server for asset building           | 5173         |
| **mysql**          | mysql:8.0                       | Primary database with health checks          | -            |
| **redis**          | redis:7-alpine                  | Cache, sessions, queues (password-protected) | -            |
| **phpmyadmin**     | phpmyadmin/phpmyadmin           | Database management GUI                      | 8888         |
| **redisinsight**   | redis/redisinsight:latest       | Redis monitoring and management              | 5540         |
| **mailpit**        | axllent/mailpit                 | Email testing (SMTP sink)                    | 8025         |
| **prometheus**     | prom/prometheus:latest          | Metrics aggregation                          | 9090         |
| **grafana**        | grafana/grafana:latest          | Dashboards and visualization                 | 3000         |
| **cadvisor**       | gcr.io/cadvisor/cadvisor:latest | Container resource monitoring                | -            |
| **node-exporter**  | prom/node-exporter:latest       | Host machine metrics                         | -            |
| **redis-exporter** | oliver006/redis_exporter:latest | Redis performance metrics                    | -            |
| **mysql-exporter** | prom/mysqld-exporter:latest     | MySQL query/connection metrics               | -            |
| **alertmanager**   | prom/alertmanager:latest        | Alert routing and deduplication              | 9093         |

**Infrastructure Features:**

- üîí Security: Resource limits, health checks, non-root users, password-protected services
- üåê Networking: Single bridge network with service discovery
- üíæ Persistence: Named volumes for MySQL, Redis, Grafana, Prometheus
- üìà Monitoring: Full observability stack with pre-configured dashboards
- üöÄ Performance: Optimized PHP-FPM, OpCache, Redis caching

---

## ÔøΩ System Requirements

### Prerequisites Check

Before installation, verify your system meets these requirements:

| Component          | Minimum Version | Recommended | Purpose                        |
| ------------------ | --------------- | ----------- | ------------------------------ |
| **PHP**            | 8.2             | 8.4         | Laravel 12 requirement         |
| **Composer**       | 2.0             | 2.7+        | PHP dependency management      |
| **Node.js**        | 18.x LTS        | 20.x LTS    | Asset compilation (Vite)       |
| **npm**            | 9.x             | 10.x        | JavaScript package manager     |
| **MySQL**          | 8.0             | 8.0.35+     | Primary database               |
| **Redis**          | 6.0             | 7.0+        | Cache, sessions, queues        |
| **Docker**         | 20.10           | 24.0+       | Containerization (recommended) |
| **Docker Compose** | 2.0             | 2.24+       | Multi-container orchestration  |

### PHP Extensions Required

```bash
# Check installed PHP extensions
php -m

# Required extensions:
bcmath       # Precision mathematics
ctype        # Character type checking
curl         # HTTP client
fileinfo     # File type detection
filter       # Data filtering
gd           # Image manipulation
hash         # Hashing functions (SHA-256 for audit)
intl         # Internationalization
json         # JSON parsing
mbstring     # Multibyte string handling
openssl      # Encryption and HTTPS
pcre         # Regular expressions
pdo_mysql    # MySQL PDO driver
redis        # Redis connectivity (via PECL or predis)
session      # Session management
tokenizer    # PHP tokenizer
xml          # XML processing
zip          # ZIP archive handling
```

### Server Resources (Production)

| Deployment Size | Users      | CPU Cores | RAM    | Storage      |
| --------------- | ---------- | --------- | ------ | ------------ |
| **Small**       | < 100      | 2 cores   | 4 GB   | 20 GB SSD    |
| **Medium**      | 100-1000   | 4 cores   | 8 GB   | 50 GB SSD    |
| **Large**       | 1000-10000 | 8 cores   | 16 GB  | 100 GB SSD   |
| **Enterprise**  | 10000+     | 16+ cores | 32+ GB | 200+ GB NVMe |

### Network Requirements

- **Outbound HTTPS (443)**: Required for AI provider APIs, package downloads
- **Inbound HTTP/HTTPS**: Web server access (configure firewall for ports 80/443)
- **Email (SMTP 25/587/465)**: Notification delivery
- **Optional: SMS API**: Twilio/Vonage for SMS notifications

---

## ÔøΩ Installation Guide

Creative Trees supports multiple deployment methods to fit your infrastructure. Choose the method that best matches your environment.

### Installation Decision Tree

```mermaid
flowchart TD
    Start([Start Installation]) --> Q1{Have Docker installed?}
    Q1 -->|Yes| Docker[üê≥ Use Docker Setup]
    Q1 -->|No| Q2{Can install Docker?}
    Q2 -->|Yes| InstallDocker[Install Docker first]
    Q2 -->|No| Q3{What type of hosting?}
    Q3 -->|Shared Hosting| Shared[üì¶ Shared Hosting Setup]
    Q3 -->|VPS/Cloud| VPS[‚òÅÔ∏è VPS Production Setup]
    Q3 -->|Local Dev| Manual[üîß Manual Installation]
    InstallDocker --> Docker
    Docker --> Success([‚úÖ Production Ready])
    Shared --> Success
    VPS --> Success
    Manual --> Success

    style Start fill:#e1f5fe
    style Success fill:#c8e6c9
    style Docker fill:#fff9c4
```

---

## üê≥ Docker Enterprise Setup (Recommended)

**Best for:** Production deployments, team development, CI/CD pipelines

**Benefits:**

- ‚úÖ Consistent environment across dev/staging/prod
- ‚úÖ All 16 services pre-configured and optimized
- ‚úÖ Zero dependency conflicts
- ‚úÖ One-command deployment
- ‚úÖ Built-in monitoring and observability

### Docker Installation by Operating System

<details>
<summary><strong>ü™ü Windows 10/11 (WSL 2 Backend)</strong></summary>

#### System Requirements

- Windows 10 version 2004+ (Build 19041+) or Windows 11
- 64-bit processor with SLAT support
- 4GB RAM minimum (8GB recommended)
- Virtualization enabled in BIOS

#### Step 1: Enable WSL 2

Open **PowerShell as Administrator** and run:

```powershell
# Enable WSL and Virtual Machine Platform
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

# Restart your computer
shutdown /r /t 0

# After restart, set WSL 2 as default (run as Admin again)
wsl --set-default-version 2

# Install Ubuntu (optional but recommended)
wsl --install -d Ubuntu-22.04
```

#### Step 2: Install Docker Desktop

1. Download **[Docker Desktop for Windows](https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe)**
2. Run the installer (`Docker Desktop Installer.exe`)
3. Ensure "Use WSL 2 instead of Hyper-V" is checked
4. Click "Ok" and wait for installation
5. Restart your computer when prompted

#### Step 3: Configure Docker Desktop

1. Launch Docker Desktop from Start Menu
2. Go to **Settings** (gear icon) ‚Üí **General**
    - ‚úÖ Enable "Use the WSL 2 based engine"
3. Go to **Resources** ‚Üí **WSL Integration**
    - ‚úÖ Enable integration with your WSL 2 distro (Ubuntu)
4. Click "Apply & Restart"

#### Step 4: Verify Installation

Open **PowerShell** or **Windows Terminal**:

```powershell
# Check Docker version
docker --version
# Expected: Docker version 24.0.x, build xxxxx

# Check Docker Compose
docker compose version
# Expected: Docker Compose version v2.24.x

# Test Docker with hello-world
docker run hello-world
# Should download image and show success message
```

#### Troubleshooting Windows

| Issue                                    | Solution                                                                                         |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------ |
| "WSL 2 installation is incomplete"       | Download and install [WSL2 Linux kernel update](https://aka.ms/wsl2kernel)                       |
| "Hardware assisted virtualization" error | Enable VT-x/AMD-V in BIOS settings                                                               |
| Docker Desktop won't start               | Check if Hyper-V is enabled: `Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V` |
| Slow performance                         | Allocate more CPU/RAM in Docker Desktop ‚Üí Resources                                              |

</details>

<details>
<summary><strong>üçé macOS (Intel & Apple Silicon)</strong></summary>

#### System Requirements

- macOS 11 Big Sur or newer (12 Monterey+ recommended)
- 4GB RAM minimum (8GB recommended for Apple Silicon)
- At least 10GB free disk space

#### Method A: Using Homebrew (Recommended)

```bash
# Install Homebrew if not already installed
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Update Homebrew
brew update

# Install Docker Desktop
brew install --cask docker

# Launch Docker Desktop
open -a Docker

# Wait for Docker Desktop to fully start (menubar icon appears)
sleep 30
```

#### Method B: Direct Download

1. **Apple Silicon (M1/M2/M3):** Download [Docker Desktop for Mac (Apple Silicon)](https://desktop.docker.com/mac/main/arm64/Docker.dmg)
2. **Intel Chip:** Download [Docker Desktop for Mac (Intel)](https://desktop.docker.com/mac/main/amd64/Docker.dmg)
3. Open the `.dmg` file
4. Drag **Docker** icon to **Applications** folder
5. Launch Docker from Applications
6. Grant permissions when prompted

#### Step 2: Configure Docker Desktop

1. Launch Docker Desktop from Applications
2. Click menubar icon ‚Üí **Preferences**
3. **Resources** ‚Üí **Advanced**
    - CPUs: 4+ cores recommended
    - Memory: 8GB+ recommended
    - Swap: 2GB
    - Disk image size: 64GB+
4. Click "Apply & Restart"

#### Step 3: Verify Installation

```bash
# Check Docker version
docker --version
# Expected: Docker version 24.0.x, build xxxxx

# Check Docker Compose
docker compose version
# Expected: Docker Compose version v2.24.x

# Verify Docker is running
docker ps
# Should show empty container list (no errors)

# Test with hello-world
docker run hello-world
# Should download image and display success message

# Check available resources
docker info | grep -E 'CPUs|Total Memory'
```

#### Troubleshooting macOS

| Issue                            | Solution                                                                            |
| -------------------------------- | ----------------------------------------------------------------------------------- |
| "Docker Desktop failed to start" | Reset to factory defaults: Preferences ‚Üí Troubleshoot ‚Üí Reset to factory defaults   |
| Port 5000 already in use         | macOS AirPlay uses 5000, disable in System Preferences ‚Üí Sharing ‚Üí AirPlay Receiver |
| File sharing performance slow    | Use Docker volumes instead of bind mounts for large datasets                        |
| High CPU usage                   | Reduce allocated CPUs in Preferences ‚Üí Resources                                    |

</details>

<details>
<summary><strong>üêß Ubuntu / Debian Linux</strong></summary>

#### Supported Versions

- Ubuntu 20.04 LTS (Focal)
- Ubuntu 22.04 LTS (Jammy) **‚Üê Recommended**
- Ubuntu 24.04 LTS (Noble)
- Debian 11 (Bullseye)
- Debian 12 (Bookworm)

#### Step 1: Uninstall Old Versions

```bash
# Remove any old Docker installations
for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do
  sudo apt-get remove -y $pkg 2>/dev/null
done
```

#### Step 2: Setup Docker Repository

```bash
# Update package index
sudo apt-get update

# Install prerequisites
sudo apt-get install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# Add Docker's official GPG key
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
  sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# Setup Docker repository
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

#### Step 3: Install Docker Engine

```bash
# Update package index
sudo apt-get update

# Install Docker Engine, CLI, containerd, and plugins
sudo apt-get install -y \
    docker-ce \
    docker-ce-cli \
    containerd.io \
    docker-buildx-plugin \
    docker-compose-plugin

# Verify installation
docker --version
docker compose version
```

#### Step 4: Post-Installation (Important)

```bash
# Create docker group (usually exists)
sudo groupadd docker 2>/dev/null

# Add your user to docker group
sudo usermod -aG docker $USER

# Apply group changes (or logout/login)
newgrp docker

# Enable Docker to start on boot
sudo systemctl enable docker.service
sudo systemctl enable containerd.service

# Start Docker service
sudo systemctl start docker
```

#### Step 5: Verify Installation

```bash
# Check Docker service status
sudo systemctl status docker

# Test Docker without sudo
docker run hello-world

# Check Docker info
docker info

# Verify Docker Compose
docker compose version
```

#### Optional: Install Docker Desktop on Ubuntu

```bash
# Download Docker Desktop .deb package
wget https://desktop.docker.com/linux/main/amd64/docker-desktop-4.27.0-amd64.deb

# Install Docker Desktop
sudo apt-get install -y ./docker-desktop-4.27.0-amd64.deb

# Launch Docker Desktop
systemctl --user start docker-desktop
```

</details>

<details>
<summary><strong>üêß CentOS / RHEL / Fedora / Rocky Linux</strong></summary>

#### Supported Versions

- CentOS 7/8/9
- RHEL 7/8/9
- Fedora 37/38/39
- Rocky Linux 8/9
- AlmaLinux 8/9

#### Step 1: Uninstall Old Versions

```bash
sudo dnf remove -y \
    docker \
    docker-client \
    docker-client-latest \
    docker-common \
    docker-latest \
    docker-latest-logrotate \
    docker-logrotate \
    docker-engine \
    podman \
    runc
```

#### Step 2: Setup Docker Repository

```bash
# Install dnf plugins
sudo dnf install -y dnf-plugins-core

# Add Docker repository (Fedora/CentOS Stream)
sudo dnf config-manager --add-repo \
    https://download.docker.com/linux/fedora/docker-ce.repo

# For CentOS 7, use:
# sudo yum-config-manager --add-repo \
#     https://download.docker.com/linux/centos/docker-ce.repo
```

#### Step 3: Install Docker

```bash
# Install Docker Engine
sudo dnf install -y \
    docker-ce \
    docker-ce-cli \
    containerd.io \
    docker-buildx-plugin \
    docker-compose-plugin

# Start Docker service
sudo systemctl start docker
sudo systemctl enable docker

# Add user to docker group
sudo usermod -aG docker $USER
newgrp docker
```

#### Step 4: Verify Installation

```bash
docker --version
docker compose version
docker run hello-world
```

</details>

### Docker Installation Verification Checklist

After installing Docker on any OS, verify with these commands:

```bash
# ‚úÖ Docker daemon running
docker info

# ‚úÖ Docker Compose available
docker compose version

# ‚úÖ Can run containers without sudo (Linux)
docker run --rm hello-world

# ‚úÖ Networking works
docker run --rm curlimages/curl:latest https://www.google.com

# ‚úÖ Volume mounts work
docker run --rm -v /tmp:/test alpine ls /test
```

**Expected Output:**

- No permission errors
- "Hello from Docker!" message
- HTTP 200 response from curl
- Volume mount successful

---

### Quick Start with Docker

Once Docker is installed, deploy Creative Trees in under 10 minutes:

```bash
# 1Ô∏è‚É£ Clone the repository
git clone https://github.com/Halfirzzha/Creativetree-Production.git creativetrees
cd creativetrees

# 2Ô∏è‚É£ Copy environment file
cp .env.example .env

# 3Ô∏è‚É£ Generate application key (important!)
docker run --rm -v "$(pwd):/var/www/html" \
  -w /var/www/html \
  php:8.4-cli \
  php artisan key:generate

# 4Ô∏è‚É£ Build and start all services (first time: 5-10 minutes)
docker compose build --no-cache
docker compose up -d

# 5Ô∏è‚É£ Install PHP dependencies inside container
docker compose exec app composer install --optimize-autoloader --no-dev

# 6Ô∏è‚É£ Install Node dependencies and build assets
docker compose exec node npm install
docker compose exec node npm run build

# 7Ô∏è‚É£ Run database migrations
docker compose exec app php artisan migrate --force

# 8Ô∏è‚É£ Seed initial data (optional but recommended)
docker compose exec app php artisan db:seed --class=DatabaseSeeder

# 9Ô∏è‚É£ Create symbolic link for storage
docker compose exec app php artisan storage:link

# üîü Create your first admin user
docker compose exec app php artisan make:filament-user
```

**Follow the prompts:**

```
 Name: John Doe
 Email: admin@example.com
 Password: ********

 Success! admin@example.com may now log in at http://localhost:8080/admin
```

### Access Your Application

| Service                        | URL                         | Credentials                                                              |
| ------------------------------ | --------------------------- | ------------------------------------------------------------------------ |
| üåê **Main Application**        | http://localhost:8080       | (user created above)                                                     |
| üîê **Admin Panel**             | http://localhost:8080/admin | admin@example.com                                                        |
| üóÑÔ∏è **phpMyAdmin**              | http://localhost:8888       | Server: `mysql`<br>User: `app`<br>Password: (see `.env` ‚Üí `DB_PASSWORD`) |
| üìä **Grafana Monitoring**      | http://localhost:3000       | admin / creativetrees_grafana_2026                                       |
| üìà **Prometheus Metrics**      | http://localhost:9090       | No auth                                                                  |
| üî¥ **Redis Insight**           | http://localhost:5540       | Host: `redis`<br>Port: 6379<br>Password: creativetrees_redis_secure_2026 |
| üìß **Mailpit (Email Testing)** | http://localhost:8025       | No auth                                                                  |
| ‚ö° **Vite Dev Server**         | http://localhost:5173       | For frontend development                                                 |

### Verify Everything is Running

```bash
# Check all containers are healthy
docker compose ps

# Expected output (all services "Up" with healthy status):
# NAME                      STATUS
# creativetrees-app         Up (healthy)
# creativetrees-web         Up (healthy)
# creativetrees-mysql       Up (healthy)
# creativetrees-redis       Up (healthy)
# creativetrees-queue       Up
# ... (16 services total)

# View application logs
docker compose logs -f app

# Check database connectivity
docker compose exec app php artisan db:show
```

**üéâ Congratulations! Your Creative Trees installation is complete.**

---

### Docker Installation by Operating System

<details>
<summary><strong>ü™ü Windows (WSL 2)</strong></summary>

#### Step 1: Enable WSL 2

```powershell
# Run PowerShell as Administrator
wsl --install
wsl --set-default-version 2
```

#### Step 2: Install Docker Desktop

1. Download [Docker Desktop for Windows](https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe)
2. Run the installer
3. Enable WSL 2 backend in Settings ‚Üí General
4. Restart your computer

#### Step 3: Verify Installation

```powershell
docker --version
docker compose version
```

</details>

<details>
<summary><strong>üçé macOS</strong></summary>

#### Option A: Using Homebrew (Recommended)

```bash
# Install Homebrew if not present
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Install Docker Desktop
brew install --cask docker

# Start Docker Desktop
open -a Docker
```

#### Option B: Direct Download

1. Download [Docker Desktop for Mac](https://desktop.docker.com/mac/main/arm64/Docker.dmg) (Apple Silicon) or [Intel](https://desktop.docker.com/mac/main/amd64/Docker.dmg)
2. Drag to Applications folder
3. Launch Docker Desktop

#### Verify Installation

```bash
docker --version
docker compose version
```

</details>

<details>
<summary><strong>üêß Linux (Ubuntu/Debian)</strong></summary>

#### Step 1: Update System

```bash
sudo apt update && sudo apt upgrade -y
```

#### Step 2: Install Docker Engine

```bash
# Remove old versions
sudo apt remove docker docker-engine docker.io containerd runc 2>/dev/null

# Install prerequisites
sudo apt install -y ca-certificates curl gnupg lsb-release

# Add Docker GPG key
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# Add Docker repository
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Install Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

#### Step 3: Post-Installation

```bash
# Add user to docker group
sudo usermod -aG docker $USER

# Apply group changes (or log out/in)
newgrp docker

# Verify installation
docker --version
docker compose version
```

</details>

<details>
<summary><strong>üêß Linux (RHEL/CentOS/Fedora)</strong></summary>

```bash
# Remove old versions
sudo dnf remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

# Install Docker
sudo dnf install -y dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# Start Docker
sudo systemctl start docker
sudo systemctl enable docker

# Add user to docker group
sudo usermod -aG docker $USER
```

</details>

### Installation Flow

```mermaid
flowchart TD
    A[Clone Repository] --> B[Copy Environment File]
    B --> C{Choose Method}
    C -->|Docker| D[Build Images]
    C -->|Sail| E[Install Sail]
    C -->|Manual| F[Install Dependencies]
    D --> G[Start Containers]
    E --> G
    F --> H[Configure Services]
    G --> I[Run Migrations]
    H --> I
    I --> J[Create Admin User]
    J --> K[Access Application]

    style A fill:#e1f5fe
    style K fill:#c8e6c9
```

### Quick Start (Docker)

```bash
# 1. Clone repository
git clone https://github.com/Halfirzzha/Creativetree-Production.git
cd Creativetree-Production

# 2. Copy environment file
cp .env.example .env

# 3. Build and start containers
docker compose build --no-cache
docker compose up -d

# 4. Install dependencies
docker compose exec app composer install
docker compose exec node npm install && npm run build

# 5. Setup application
docker compose exec app php artisan key:generate
docker compose exec app php artisan migrate --seed
docker compose exec app php artisan storage:link

# 6. Create admin user
docker compose exec app php artisan make:filament-user

# 7. Access application
# Main App: http://localhost:8080
# Admin Panel: http://localhost:8080/admin
```

### Available Services

| Service           | URL                         | Purpose                    |
| ----------------- | --------------------------- | -------------------------- |
| **Application**   | http://localhost:8080       | Main Laravel application   |
| **Admin Panel**   | http://localhost:8080/admin | Filament admin interface   |
| **phpMyAdmin**    | http://localhost:8081       | Database management        |
| **Redis Insight** | http://localhost:5540       | Redis monitoring           |
| **Mailpit**       | http://localhost:8025       | Email testing              |
| **Prometheus**    | http://localhost:9090       | Metrics collection         |
| **Grafana**       | http://localhost:3001       | Dashboards & visualization |
| **Alertmanager**  | http://localhost:9093       | Alert management           |

---

## üìã Docker Commands Reference

### Essential Container Operations

```bash
# Start all services (detached mode)
docker compose up -d

# Start with rebuild (after code changes)
docker compose up -d --build

# Stop all services (preserves data)
docker compose down

# Stop and remove volumes (‚ö†Ô∏è deletes all data)
docker compose down -v

# Restart specific service
docker compose restart app
docker compose restart queue

# View status of all containers
docker compose ps

# View resource usage
docker stats
```

###Laravel Artisan Commands

All Laravel `artisan` commands run inside the `app` container:

```bash
# General syntax
docker compose exec app php artisan <command>

# User management
docker compose exec app php artisan make:filament-user
docker compose exec app php artisan tinker

# Database operations
docker compose exec app php artisan migrate
docker compose exec app php artisan migrate:fresh --seed
docker compose exec app php artisan migrate:status
docker compose exec app php artisan db:seed
docker compose exec app php artisan db:show

# Cache management
docker compose exec app php artisan cache:clear
docker compose exec app php artisan config:clear
docker compose exec app php artisan route:clear
docker compose exec app php artisan view:clear
docker compose exec app php artisan optimize:clear  # Clear all caches

# Optimization (production)
docker compose exec app php artisan config:cache
docker compose exec app php artisan route:cache
docker compose exec app php artisan view:cache
docker compose exec app php artisan optimize

# Queue management
docker compose exec app php artisan queue:work
docker compose exec app php artisan queue:restart
docker compose exec app php artisan queue:retry all
docker compose exec app php artisan queue:failed

# Storage
docker compose exec app php artisan storage:link

# Application info
docker compose exec app php artisan about
docker compose exec app php artisan env
```

### Composer & NPM Commands

```bash
# Composer (PHP dependencies)
docker compose exec app composer install
docker compose exec app composer update
docker compose exec app composer require vendor/package
docker compose exec app composer dump-autoload

# NPM (JavaScript dependencies)
docker compose exec node npm install
docker compose exec node npm update
docker compose exec node npm run build
docker compose exec node npm run dev

# Vite development server
docker compose exec node npm run dev
```

### Database Operations

```bash
# MySQL CLI access
docker compose exec mysql mysql -u app -p
# Password: (from .env ‚Üí DB_PASSWORD)

# Create database backup
docker compose exec mysql mysqldump -u root -p creativetrees > backup_$(date +%Y%m%d_%H%M%S).sql

# Restore database from backup
docker compose exec -T mysql mysql -u root -p creativetrees < backup_20260202_120000.sql

# Check database size
docker compose exec mysql mysql -u root -p -e "SELECT table_schema AS 'Database', ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)' FROM information_schema.tables GROUP BY table_schema;"
```

### Redis Operations

```bash
# Redis CLI access
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026

# Common Redis commands (inside redis-cli)
PING                    # Test connection
KEYS *                  # List all keys (‚ö†Ô∏è slow in production)
DBSIZE                  # Number of keys
INFO                    # Server information
FLUSHDB                 # Clear current database (‚ö†Ô∏è destructive)
FLUSHALL                # Clear all databases (‚ö†Ô∏è very destructive)
MONITOR                 # Watch real-time commands

# Flush specific cache prefix (outside CLI)
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 --scan --pattern "creativetrees:cache:*" | xargs docker compose exec -T redis redis-cli -a creativetrees_redis_secure_2026 DEL
```

### Logging & Debugging

```bash
# View real-time logs (all services)
docker compose logs -f

# View logs for specific service
docker compose logs -f app
docker compose logs -f queue
docker compose logs -f web

# View last 100 lines
docker compose logs --tail=100 app

# Laravel application logs
docker compose exec app tail -f storage/logs/laravel.log

# Nginx access logs
docker compose logs web | grep "GET\|POST"

# Check for errors
docker compose logs app | grep -i error
```

### Shell Access

```bash
# Access app container shell (bash)
docker compose exec app bash

# Access as root (for system-level operations)
docker compose exec -u root app bash

# Access MySQL container
docker compose exec mysql bash

# Access Node container
docker compose exec node sh  # Alpine uses sh instead of bash

# One-off command without entering shell
docker compose exec app ls -la storage/
```

### Health Checks & Monitoring

```bash
# Check container health status
docker compose ps

# Inspect specific container
docker inspect creativetrees-app

# View container resource usage
docker stats

# Check nginx configuration syntax
docker compose exec web nginx -t

# Check PHP-FPM status
docker compose exec app php-fpm -t

# Test MySQL connection from app
docker compose exec app php artisan db:show
```

### Advanced Docker Operations

```bash
# Rebuild single service
docker compose build app
docker compose up -d app

# Force recreate containers
docker compose up -d --force-recreate

# Remove unused images and volumes (cleanup)
docker system prune -a
docker volume prune

# View docker disk usage
docker system df

# Export container as image
docker commit creativetrees-app my-creativetrees-snapshot:v1.0

# Copy files from/to container
docker cp creativetrees-app:/var/www/html/storage/logs/laravel.log ./local-laravel.log
docker cp ./local-file.txt creativetrees-app:/var/www/html/storage/app/
```

### Troubleshooting Commands

```bash
# Restart all services with clean state
docker compose down
docker compose up -d --build --force-recreate

# Fix permissions
docker compose exec app chown -R www-data:www-data storage bootstrap/cache
docker compose exec app chmod -R 775 storage bootstrap/cache

# Clear everything and start fresh (‚ö†Ô∏è deletes all data)
docker compose down -v
docker compose build --no-cache
docker compose up -d

# Check environment variables
docker compose exec app env | grep -E 'DB_|REDIS_|APP_'

# Verify services are accessible
docker compose exec app php artisan db:show  # Database
docker compose exec app php -r "var_dump((new Predis\Client(['host' => 'redis', 'port' => 6379, 'password' => 'creativetrees_redis_secure_2026']))->ping());"  # Redis
```

### Production Deployment Workflow

```bash
# 1. Pull latest code
git pull origin main

# 2. Rebuild containers
docker compose build --no-cache

# 3. Stop and start with new images
docker compose down
docker compose up -d

# 4. Install/update dependencies
docker compose exec app composer install --optimize-autoloader --no-dev
docker compose exec node npm install
docker compose exec node npm run build

# 5. Run migrations
docker compose exec app php artisan migrate --force

# 6. Clear and rebuild cache
docker compose exec app php artisan optimize:clear
docker compose exec app php artisan optimize

# 7. Restart queue workers
docker compose exec app php artisan queue:restart

# 8. Verify everything is running
docker compose ps
docker compose exec app php artisan about
```

### Useful Aliases

Add to `~/.bashrc` or `~/.zshrc` for faster commands:

```bash
# Creative Trees Docker aliases
alias ct-up='docker compose up -d'
alias ct-down='docker compose down'
alias ct-restart='docker compose restart'
alias ct-ps='docker compose ps'
alias ct-logs='docker compose logs -f'

# Artisan shortcut
alias ct-artisan='docker compose exec app php artisan'
alias ct-tinker='docker compose exec app php artisan tinker'
alias ct-migrate='docker compose exec app php artisan migrate'

# Shell access
alias ct-shell='docker compose exec app bash'
alias ct-mysql='docker compose exec mysql mysql -u app -p'
alias ct-redis='docker compose exec redis redis-cli -a creativetrees_redis_secure_2026'

# Common operations
alias ct-optimize='docker compose exec app php artisan optimize'
alias ct-clear='docker compose exec app php artisan optimize:clear'
alias ct-user='docker compose exec app php artisan make:filament-user'
```

After adding, reload shell:

```bash
source ~/.bashrc  # or source ~/.zshrc
```

Now you can use:

```bash
ct-up              # Start all services
ct-artisan migrate # Run migrations
ct-shell           # Access app container
ct-user            # Create Filament user
```

---

## ‚öì Laravel Sail Installation

**Best for:** Local development on macOS/Linux, quick prototyping

Laravel Sail is Laravel's official Docker development environment. It's simpler than the full Docker setup but less feature-complete.

### Differences: Sail vs Full Docker

| Feature            | Laravel Sail                                | Full Docker (Creative Trees)        |
| ------------------ | ------------------------------------------- | ----------------------------------- |
| Services           | 5 (app, mysql, redis, mailhog, meilisearch) | 16 (+ monitoring, management tools) |
| Monitoring         | ‚ùå None                                     | ‚úÖ Prometheus + Grafana             |
| Database GUI       | ‚ùå None                                     | ‚úÖ phpMyAdmin                       |
| Redis GUI          | ‚ùå None                                     | ‚úÖ Redis Insight                    |
| Production Ready   | ‚ö†Ô∏è Dev-focused                              | ‚úÖ Yes                              |
| Security Hardening | ‚ö†Ô∏è Basic                                    | ‚úÖ Enterprise-grade                 |
| Setup Complexity   | Low                                         | Medium                              |

### Installation Steps

```bash
# 1Ô∏è‚É£ Clone repository
git clone https://github.com/Halfirzzha/Creativetree-Production.git creativetrees
cd creativetrees

# 2Ô∏è‚É£ Install Composer dependencies (without requiring PHP locally)
docker run --rm \
    -u "$(id -u):$(id -g)" \
    -v "$(pwd):/var/www/html" \
    -w /var/www/html \
    laravelsail/php84-composer:latest \
    composer install --ignore-platform-reqs

# 3Ô∏è‚É£ Copy environment file
cp .env.example .env

# 4Ô∏è‚É£ Start Sail
./vendor/bin/sail up -d

# 5Ô∏è‚É£ Generate application key
./vendor/bin/sail artisan key:generate

# 6Ô∏è‚É£ Run migrations
./vendor/bin/sail artisan migrate --seed

# 7Ô∏è‚É£ Install Node dependencies
./vendor/bin/sail npm install

# 8Ô∏è‚É£ Build assets
./vendor/bin/sail npm run build

# 9Ô∏è‚É£ Create admin user
./vendor/bin/sail artisan make:filament-user
```

### Sail Command Reference

```bash
# Start Sail
./vendor/bin/sail up -d

# Stop Sail
./vendor/bin/sail down

# Run artisan commands
./vendor/bin/sail artisan migrate
./vendor/bin/sail artisan tinker

# Composer
./vendor/bin/sail composer install
./vendor/bin/sail composer require vendor/package

# NPM
./vendor/bin/sail npm install
./vendor/bin/sail npm run dev

# Access shell
./vendor/bin/sail shell

# View logs
./vendor/bin/sail logs
```

### Create Sail Alias (Optional)

Add to `~/.bashrc`, `~/.zshrc`, or `~/.bash_profile`:

```bash
alias sail='[ -f sail ] && sh sail || sh vendor/bin/sail'
```

Then you can use shorter commands:

```bash
sail up -d
sail artisan migrate
sail npm run dev
```

---

## üîß Manual Installation (Non-Docker)

**Best for:** Shared hosting, cPanel environments, existing LAMP/LEMP stacks

### Prerequisites

Ensure you have installed:

- PHP 8.4 with all required extensions
- MySQL 8.0+ or MariaDB 10.6+
- Redis 7.0+ (or use `array` cache driver)
- Composer 2.7+
- Node.js 20.x LTS + npm

### Installation Steps

```bash
# 1Ô∏è‚É£ Clone repository
git clone https://github.com/Halfirzzha/Creativetree-Production.git creativetrees
cd creativetrees

# 2Ô∏è‚É£ Install PHP dependencies
composer install --optimize-autoloader --no-dev

# 3Ô∏è‚É£ Copy and configure environment
cp .env.example .env
php artisan key:generate

# 4Ô∏è‚É£ Configure database in .env
nano .env  # or vim, code, etc.

# Update these values:
# DB_CONNECTION=mysql
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=your_database_name
# DB_USERNAME=your_database_user
# DB_PASSWORD=your_database_password

# 5Ô∏è‚É£ Configure Redis (optional but recommended)
# REDIS_HOST=127.0.0.1
# REDIS_PASSWORD=null
# REDIS_PORT=6379

# If Redis not available, use file-based:
# CACHE_DRIVER=file
# SESSION_DRIVER=file
# QUEUE_CONNECTION=database

# 6Ô∏è‚É£ Run database migrations
php artisan migrate --force

# 7Ô∏è‚É£ Seed initial data
php artisan db:seed

# 8Ô∏è‚É£ Create storage symlink
php artisan storage:link

# 9Ô∏è‚É£ Set correct permissions
chmod -R 755 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache

# üîü Install Node dependencies and build assets
npm install
npm run build

# 1Ô∏è‚É£1Ô∏è‚É£ Create admin user
php artisan make:filament-user

# 1Ô∏è‚É£2Ô∏è‚É£ Optimize for production
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan optimize
```

### Web Server Configuration

<details>
<summary><strong>Apache (.htaccess already included)</strong></summary>

Enable required modules:

```bash
sudo a2enmod rewrite
sudo a2enmod ssl
sudo a2enmod headers
sudo systemctl restart apache2
```

Virtual host configuration (`/etc/apache2/sites-available/creativetrees.conf`):

```apache
<VirtualHost *:80>
    ServerName creativetrees.yourdomain.com
    ServerAdmin admin@yourdomain.com
    DocumentRoot /var/www/creativetrees/public

    <Directory /var/www/creativetrees>
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/creativetrees-error.log
    CustomLog ${APACHE_LOG_DIR}/creativetrees-access.log combined

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</VirtualHost>
```

Enable site:

```bash
sudo a2ensite creativetrees
sudo systemctl reload apache2
```

</details>

<details>
<summary><strong>Nginx (Recommended)</strong></summary>

Configuration (`/etc/nginx/sites-available/creativetrees`):

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name creativetrees.yourdomain.com;
    root /var/www/creativetrees/public;

    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

Enable site:

```bash
sudo ln -s /etc/nginx/sites-available/creativetrees /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

</details>

### Background Processes (Queue & Scheduler)

<details>
<summary><strong>Supervisor Configuration (Recommended)</strong></summary>

Install Supervisor:

```bash
sudo apt-get install supervisor
```

Create config (`/etc/supervisor/conf.d/creativetrees-worker.conf`):

```ini
[program:creativetrees-queue]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/creativetrees/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/creativetrees/storage/logs/queue-worker.log
stopwaitsecs=3600
```

Scheduler cron (`crontab -e` for www-data user):

```cron
* * * * * cd /var/www/creativetrees && php artisan schedule:run >> /dev/null 2>&1
```

Start Supervisor:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start creativetrees-queue:*
```

</details>

---

## üåê Shared Hosting Deployment

**Best for:** cPanel, Plesk, shared environments without SSH/Docker

### Step-by-Step Guide

#### 1. Prepare Files Locally

```bash
# Clone and prepare locally
git clone https://github.com/Halfirzzha/Creativetree-Production.git
cd Creativetree-Production

# Install dependencies
composer install --optimize-autoloader --no-dev
npm install && npm run build

# Configure environment
cp .env.example .env
php artisan key:generate

# Update .env with shared hosting database credentials
```

#### 2. Upload Files via FTP/SFTP

Upload these directories to your hosting (e.g., `public_html/creativetrees/`):

- `app/`
- `bootstrap/`
- `config/`
- `database/`
- `public/`
- `resources/`
- `routes/`
- `storage/`
- `vendor/` (already installed)
- `.env`
- `artisan`
- `composer.json`

**Important:** Do NOT upload:

- `node_modules/`
- `.git/`
- `tests/`
- `docker/`
- `docker-compose.yml`

#### 3. Configure Document Root

In cPanel or hosting panel:

- Set document root to `/public_html/creativetrees/public`
- **Not** the parent directory

#### 4. Set Folder Permissions

Via SSH or FTP client:

```bash
chmod -R 755 storage bootstrap/cache
```

Or in cPanel File Manager:

- Right-click `storage/` ‚Üí Permissions ‚Üí 755 (recursive)
- Right-click `bootstrap/cache/` ‚Üí Permissions ‚Üí 755 (recursive)

#### 5. Create Database

In cPanel ‚Üí MySQL Databases:

1. Create database: `creativet_production`
2. Create user: `creativet_user`
3. Assign user to database with all privileges
4. Note credentials

#### 6. Update .env File

Edit `.env` via cPanel File Manager or FTP:

```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://yourdomain.com

DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=creativet_production
DB_USERNAME=creativet_user
DB_PASSWORD=your_secure_password

# Use file-based cache/sessions (Redis often not available)
CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=database
```

#### 7. Run Migrations via SSH

If SSH access available:

```bash
cd /home/username/public_html/creativetrees
php artisan migrate --force
php artisan db:seed
php artisan storage:link
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

If no SSH, use a web-based installer script (create `install.php` in public):

```php
<?php
require __DIR__.'/../vendor/autoload.php';
$app = require_once __DIR__.'/../bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Console\Kernel::class);

echo "<pre>";
echo "Running migrations...\n";
$kernel->call('migrate', ['--force' => true]);

echo "\nSeeding database...\n";
$kernel->call('db:seed');

echo "\nCreating storage link...\n";
$kernel->call('storage:link');

echo "\nOptimizing...\n";
$kernel->call('config:cache');
$kernel->call('route:cache');
$kernel->call('view:cache');

echo "\n‚úÖ Installation complete! Delete this file for security.\n";
echo "</pre>";
```

Visit `https://yourdomain.com/install.php` then **delete it immediately**.

#### 8. Setup Cron Job

In cPanel ‚Üí Cron Jobs, add:

```
* * * * * /usr/bin/php /home/username/public_html/creativetrees/artisan schedule:run >> /dev/null 2>&1
```

### Shared Hosting Limitations

| Feature            | Available?           | Alternative                               |
| ------------------ | -------------------- | ----------------------------------------- |
| Redis              | ‚ùå Usually not       | Use `CACHE_DRIVER=file`                   |
| Queue Workers      | ‚ùå Usually not       | Use `QUEUE_CONNECTION=database` + cron    |
| Supervisor         | ‚ùå No daemon support | Manual queue processing via cron          |
| Custom PHP version | ‚ö†Ô∏è Limited           | Request PHP 8.4 from hosting support      |
| SSH Access         | ‚ö†Ô∏è Varies            | Use web-based installer or request access |

---

## ‚òÅÔ∏è VPS/Production Server Setup

**Best for:** Full control, production environments, Ubuntu 22.04 LTS

### Complete Server Setup (Ubuntu 22.04)

```bash
# 1Ô∏è‚É£ Update system
sudo apt update && sudo apt upgrade -y

# 2Ô∏è‚É£ Install dependencies
sudo apt install -y software-properties-common ca-certificates lsb-release apt-transport-https

# 3Ô∏è‚É£ Add PHP 8.4 repository (Ond≈ôej Sur√Ω PPA)
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update

# 4Ô∏è‚É£ Install PHP 8.4 + extensions
sudo apt install -y php8.4-fpm php8.4-cli php8.4-common \
    php8.4-mysql php8.4-redis php8.4-curl php8.4-gd \
    php8.4-mbstring php8.4-xml php8.4-zip php8.4-bcmath \
    php8.4-intl php8.4-opcache php8.4-readline

# 5Ô∏è‚É£ Install Nginx
sudo apt install -y nginx

# 6Ô∏è‚É£ Install MySQL 8.0
sudo apt install -y mysql-server
sudo mysql_secure_installation

# 7Ô∏è‚É£ Install Redis
sudo apt install -y redis-server
sudo systemctl enable redis-server
sudo systemctl start redis-server

# 8Ô∏è‚É£ Install Composer
curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer

# 9Ô∏è‚É£ Install Node.js 20.x LTS
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# üîü Install Supervisor (for queue workers)
sudo apt install -y supervisor
```

### Deploy Application

```bash
# Create deployment directory
sudo mkdir -p /var/www/creativetrees
sudo chown -R $USER:www-data /var/www/creativetrees
cd /var/www/creativetrees

# Clone repository
git clone https://github.com/Halfirzzha/Creativetree-Production.git .

# Install dependencies
composer install --optimize-autoloader --no-dev
npm install && npm run build

# Configure environment
cp .env.example .env
php artisan key:generate

# Edit .env with production values
nano .env

# Run migrations
php artisan migrate --force
php artisan db:seed

# Set permissions
sudo chown -R www-data:www-data storage bootstrap/cache
sudo chmod -R 775 storage bootstrap/cache

# Optimize
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan storage:link
```

### Nginx Production Configuration

Create `/etc/nginx/sites-available/creativetrees`:

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name yourdomain.com www.yourdomain.com;
    root /var/www/creativetrees/public;

    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    index index.php;
    charset utf-8;
    client_max_body_size 100M;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

Enable site:

```bash
sudo ln -s /etc/nginx/sites-available/creativetrees /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### SSL Certificate (Let's Encrypt)

```bash
# Install Certbot
sudo apt install -y certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Auto-renewal is configured automatically
# Test renewal:
sudo certbot renew --dry-run
```

### Supervisor Configuration

Create `/etc/supervisor/conf.d/creativetrees.conf`:

```ini
[program:creativetrees-queue]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/creativetrees/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/creativetrees/storage/logs/queue-worker.log
stopwaitsecs=3600
```

Start queue workers:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start creativetrees-queue:*
```

### Scheduler Cron

```bash
sudo crontab -e -u www-data

# Add this line:
* * * * * cd /var/www/creativetrees && php artisan schedule:run >> /dev/null 2>&1
```

### Firewall Configuration

```bash
# Enable UFW firewall
sudo ufw allow OpenSSH
sudo ufw allow 'Nginx Full'
sudo ufw enable
sudo ufw status
```

---

## üèóÔ∏è Architecture & Design

### Technology Stack

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         FRONTEND LAYER                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Filament v4 Admin Panel  ‚îÇ  Livewire 3  ‚îÇ  Alpine.js  ‚îÇ  Vite ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        APPLICATION LAYER                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         Laravel 12  ‚îÇ  PHP 8.4-FPM  ‚îÇ  Composer 2.7+           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          DATA LAYER                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  MySQL 8.0 (Primary)  ‚îÇ  Redis 7.0 (Cache/Queue/Session)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      INFRASTRUCTURE LAYER                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Docker  ‚îÇ  Nginx  ‚îÇ  Supervisor  ‚îÇ  Prometheus  ‚îÇ  Grafana   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### System Architecture (Docker Stack)

```mermaid
graph TB
    subgraph Internet
        User([üë§ End User])
        Admin([üë®‚Äçüíº Administrator])
    end

    subgraph Edge["Edge Layer (Port 8080)"]
        Nginx[Nginx Reverse Proxy<br/>+ Security Headers]
    end

    subgraph Application["Application Layer"]
        App[Laravel App Container<br/>PHP 8.4-FPM]
        Queue[Queue Worker<br/>Background Jobs]
        Scheduler[Task Scheduler<br/>Cron Jobs]
        Node[Vite Dev Server<br/>Asset Building]
    end

    subgraph Data["Data Layer"]
        MySQL[(MySQL 8.0<br/>Primary Database)]
        Redis[(Redis 7.0<br/>Cache/Session/Queue)]
    end

    subgraph Management["Management Tools"]
        phpMyAdmin[phpMyAdmin<br/>:8888]
        RedisInsight[Redis Insight<br/>:5540]
        Mailpit[Mailpit<br/>:8025]
    end

    subgraph Monitoring["Observability Stack"]
        Prometheus[Prometheus<br/>:9090]
        Grafana[Grafana<br/>:3000]
        AlertManager[Alertmanager<br/>:9093]
        cAdvisor[cAdvisor<br/>Container Metrics]
        NodeExporter[Node Exporter<br/>Host Metrics]
        RedisExporter[Redis Exporter<br/>Redis Metrics]
        MySQLExporter[MySQL Exporter<br/>DB Metrics]
    end

    User --> Nginx
    Admin --> Nginx
    Admin --> phpMyAdmin
    Admin --> RedisInsight
    Admin --> Mailpit
    Admin --> Grafana

    Nginx --> App
    App --> MySQL
    App --> Redis
    App --> Queue
    Queue --> Redis
    Scheduler --> App
    Node -.->|Build Assets| App

    phpMyAdmin --> MySQL
    RedisInsight --> Redis

    Prometheus --> cAdvisor
    Prometheus --> NodeExporter
    Prometheus --> RedisExporter
    Prometheus --> MySQLExporter
    Prometheus --> AlertManager
    Grafana --> Prometheus

    style User fill:#e1f5fe
    style Admin fill:#fff9c4
    style Nginx fill:#00C853
    style App fill:#FF2D20,color:#fff
    style MySQL fill:#4479A1,color:#fff
    style Redis fill:#DC382D,color:#fff
    style Prometheus fill:#E6522C,color:#fff
    style Grafana fill:#F46800,color:#fff
```

### HTTP Request Lifecycle

```mermaid
sequenceDiagram
    participant C as Client Browser
    participant N as Nginx
    participant P as PHP-FPM
    participant L as Laravel Kernel
    participant M as Middleware Stack
    participant R as Route Handler
    participant D as Database
    participant Cache as Redis Cache
    participant Q as Queue

    C->>N: HTTP Request<br/>(GET /admin/users)
    N->>N: Apply Security Headers
    N->>P: Forward to PHP-FPM
    P->>L: Bootstrap Application

    L->>Cache: Load Config from Cache
    Cache-->>L: Cached Config

    L->>M: Execute Middleware Chain

    rect rgb(255, 240, 240)
    M->>M: 1. CSRF Verification
    M->>Cache: 2. Session Validation
    Cache-->>M: Session Data
    M->>M: 3. Authentication Check
    M->>D: 4. Load User & Permissions
    D-->>M: User Model
    M->>M: 5. RBAC Authorization
    M->>M: 6. Audit Log Middleware
    M->>M: 7. Threat Detection
    end

    M->>R: Dispatch to Controller
    R->>D: Query Database
    D-->>R: Result Set

    R->>Cache: Check for Cached Data
    alt Cache Hit
        Cache-->>R: Cached Response
    else Cache Miss
        R->>D: Fetch from DB
        D-->>R: Fresh Data
        R->>Cache: Store in Cache
    end

    R->>Q: Dispatch Background Job
    Note over Q: Processed asynchronously

    R->>L: Return Response
    L->>N: HTTP Response
    N->>C: Deliver to Client

    rect rgb(240, 255, 240)
    Q->>Q: Process Background Job
    Q->>D: Update Database
    Q->>Cache: Clear Related Cache
    end
```

### Authentication & Authorization Flow

```mermaid
flowchart TD
    Start([User Login Attempt]) --> ValidateCredentials{Valid<br/>Credentials?}

    ValidateCredentials -->|No| LogFailure[Log Failed Attempt]
    LogFailure --> IncrementAttempts{Attempts >= 5?}
    IncrementAttempts -->|Yes| LockAccount[Lock Account<br/>15 minutes]
    IncrementAttempts -->|No| ReturnError1[Return Error]
    LockAccount --> ReturnError1
    ReturnError1 --> End1([Login Failed])

    ValidateCredentials -->|Yes| CheckPassword{Password<br/>Valid?}
    CheckPassword -->|No| CheckHIBP{In HIBP<br/>Breach DB?}
    CheckHIBP -->|Yes| ForceReset[Force Password Reset]
    CheckHIBP -->|No| CheckExpiry{Password<br/>Expired?}
    CheckExpiry -->|Yes| ForceReset
    CheckExpiry -->|No| CreateSession
    ForceReset --> End2([Redirect to Reset])

    CheckPassword -->|Yes| CheckAccount{Account<br/>Active?}
    CheckAccount -->|No| ReturnError2[Return Suspended Error]
    ReturnError2 --> End3([Access Denied])

    CheckAccount -->|Yes| CreateSession[Create Session]
    CreateSession --> GenerateStamp[Generate Session Stamp]
    GenerateStamp --> StoreDevice[Store Device Fingerprint]
    StoreDevice --> CheckRole{User<br/>Role?}

    CheckRole -->|Super Admin| GrantAllPerms[Grant All Permissions]
    CheckRole -->|Admin| GrantAdminPerms[Grant Admin Permissions]
    CheckRole -->|Manager| GrantManagerPerms[Grant Manager Permissions]
    CheckRole -->|Supervisor| GrantSupervisorPerms[Grant Supervisor Permissions]
    CheckRole -->|User| GrantBasicPerms[Grant Basic Permissions]

    GrantAllPerms --> LogActivity
    GrantAdminPerms --> LogActivity
    GrantManagerPerms --> LogActivity
    GrantSupervisorPerms --> LogActivity
    GrantBasicPerms --> LogActivity[Log Login Activity]

    LogActivity --> AuditLog[Create Tamper-Evident<br/>Audit Entry]
    AuditLog --> Success([‚úÖ Login Successful])

    style Start fill:#e1f5fe
    style Success fill:#c8e6c9
    style End1 fill:#ffcdd2
    style End2 fill:#fff9c4
    style End3 fill:#ffcdd2
    style LockAccount fill:#ff5252,color:#fff
    style ForceReset fill:#ffa726,color:#fff
    style AuditLog fill:#00C853,color:#fff
```

### Role-Based Access Control (RBAC) Hierarchy

```mermaid
graph TD
    SA[üî¥ Super Admin<br/>Level 1]
    A[üü† Admin<br/>Level 2]
    M[üü° Manager<br/>Level 3]
    S[üü¢ Supervisor<br/>Level 4]
    U[üîµ User<br/>Level 5]

    SA --> A
    A --> M
    M --> S
    S --> U

    SA -.->|All Permissions| P1[‚úÖ System Settings<br/>‚úÖ User Management<br/>‚úÖ Role Assignment<br/>‚úÖ Audit Log Access<br/>‚úÖ AI Configuration<br/>‚úÖ Maintenance Mode]

    A -.->|Admin Scope| P2[‚úÖ User CRUD<br/>‚úÖ Reports Access<br/>‚úÖ Notification Management<br/>‚õî System Settings]

    M -.->|Manager Scope| P3[‚úÖ Team Management<br/>‚úÖ Approval Workflows<br/>‚úÖ Department Reports<br/>‚õî Role Assignment]

    S -.->|Supervisor Scope| P4[‚úÖ Task Assignment<br/>‚úÖ Basic Approvals<br/>‚õî User Management]

    U -.->|Basic Access| P5[‚úÖ Own Profile<br/>‚úÖ Assigned Tasks<br/>‚õî Admin Features]

    style SA fill:#ef5350,color:#fff
    style A fill:#ff9800,color:#fff
    style M fill:#fdd835,color:#000
    style S fill:#66bb6a,color:#fff
    style U fill:#42a5f5,color:#fff
```

### Audit Log Hash Chain

```mermaid
flowchart LR
    G[Genesis Entry<br/>hash: sha256('initial')]

    E1[Entry 1<br/>Previous: Genesis<br/>Data: User Login<br/>hash: sha256(Genesis + Data1)]

    E2[Entry 2<br/>Previous: Entry 1<br/>Data: Profile Update<br/>hash: sha256(Entry1 + Data2)]

    E3[Entry 3<br/>Previous: Entry 2<br/>Data: Permission Change<br/>hash: sha256(Entry2 + Data3)]

    E4[Entry N<br/>Previous: Entry N-1<br/>Data: Action<br/>hash: sha256(EntryN-1 + DataN)]

    G -->|Link| E1
    E1 -->|Link| E2
    E2 -->|Link| E3
    E3 -.->|Link| E4

    V{Verification}
    V -.->|Recalculate| E1
    V -.->|Recalculate| E2
    V -.->|Recalculate| E3

    V -->|If hash mismatch| T[üö® TAMPER DETECTED]
    V -->|All hashes valid| OK[‚úÖ Integrity Verified]

    style G fill:#e1f5fe
    style E1 fill:#c8e6c9
    style E2 fill:#c8e6c9
    style E3 fill:#c8e6c9
    style E4 fill:#fff9c4
    style T fill:#ff5252,color:#fff
    style OK fill:#00C853,color:#fff
```

### AI Provider Failover Cascade

```mermaid
flowchart TD
    Request[AI Request Initiated]

    Request --> Primary{Primary Provider<br/>OpenAI}

    Primary -->|Success| Return1[‚úÖ Return Response]
    Primary -->|Timeout/Error| Secondary{Secondary Provider<br/>Anthropic}

    Secondary -->|Success| Return2[‚úÖ Return Response]
    Secondary -->|Timeout/Error| Tertiary{Tertiary Provider<br/>Groq}

    Tertiary -->|Success| Return3[‚úÖ Return Response]
    Tertiary -->|Timeout/Error| Fallback{Fallback Provider<br/>DeepSeek}

    Fallback -->|Success| Return4[‚úÖ Return Response]
    Fallback -->|All Failed| Log[üìù Log Failure]

    Log --> Alert[üö® Send Alert to Admin]
    Alert --> Error[‚ùå Return Error to User]

    Return1 --> Cache[üíæ Cache Response]
    Return2 --> Cache
    Return3 --> Cache
    Return4 --> Cache

    Cache --> Analytics[üìä Log Usage Metrics]
    Analytics --> Done([Request Complete])
    Error --> Done

    style Request fill:#e1f5fe
    style Primary fill:#fff9c4
    style Secondary fill:#fff9c4
    style Tertiary fill:#fff9c4
    style Fallback fill:#fff9c4
    style Error fill:#ffcdd2
    style Done fill:#c8e6c9
```

### Database Schema Overview

```mermaid
erDiagram
    USERS ||--o{ AUDIT_LOGS : creates
    USERS ||--o{ USER_LOGIN_ACTIVITY : has
    USERS ||--o{ USER_PASSWORD_HISTORY : has
    USERS ||--o{ USER_INVITATIONS : sends
    USERS ||--o{ USER_NOTIFICATIONS : receives
    USERS }o--|| ROLES : has_role

    NOTIFICATION_MESSAGES ||--o{ NOTIFICATION_DELIVERIES : delivered_via
    NOTIFICATION_MESSAGES ||--o{ USER_NOTIFICATIONS : sent_to
    NOTIFICATION_CHANNELS ||--o{ NOTIFICATION_DELIVERIES : uses

    USERS {
        bigint id PK
        string name
        string email UK
        string password
        enum role
        enum status
        timestamp session_stamp
        timestamp password_expires_at
        timestamps created_updated
    }

    AUDIT_LOGS {
        bigint id PK
        string event_type
        bigint user_id FK
        text data
        string hash
        string previous_hash
        timestamps created_at
    }

    USER_LOGIN_ACTIVITY {
        bigint id PK
        bigint user_id FK
        string ip_address
        string user_agent
        boolean successful
        timestamp logged_at
    }

    NOTIFICATION_MESSAGES {
        bigint id PK
        string title
        text body
        json data
        timestamps created_at
    }

    NOTIFICATION_DELIVERIES {
        bigint id PK
        bigint message_id FK
        bigint channel_id FK
        enum status
        text error_message
        timestamps delivered_at
    }
```

---

## üîí Security Hardening

Creative Trees achieves a **9/10 security score** through multi-layered defense mechanisms, cryptographic integrity, and compliance-ready features.

### Security Scorecard

| Category                | Score | Implementation                                                    |
| ----------------------- | ----- | ----------------------------------------------------------------- |
| **Authentication**      | 10/10 | Laravel Fortify, session stamping, device fingerprinting          |
| **Authorization**       | 10/10 | 5-level RBAC, granular permissions, SOD enforcement               |
| **Audit Logging**       | 10/10 | SHA-256 hash chain, tamper detection, immutable logs              |
| **Password Security**   | 10/10 | NIST 800-63B compliant, HIBP breach detection, history tracking   |
| **Session Management**  | 9/10  | Device tracking, concurrent limits, automatic expiration          |
| **Threat Detection**    | 9/10  | Adaptive risk scoring, IP blocking, pattern recognition           |
| **Data Protection**     | 8/10  | Encryption at rest (database level), bcrypt password hashing      |
| **Network Security**    | 9/10  | HTTPS enforcement, security headers, CSP, rate limiting           |
| **Dependency Security** | 8/10  | Regular updates, Composer audit, automated vulnerability scanning |
| **Infrastructure**      | 9/10  | Docker isolation, non-root containers, resource limits            |

**Overall: 9.2/10** (Enterprise-Grade)

### üõ°Ô∏è Security Features Matrix

<details>
<summary><strong>1. Authentication & Identity</strong></summary>

| Feature                         | Implementation                                        | Compliance                   |
| ------------------------------- | ----------------------------------------------------- | ---------------------------- |
| **Multi-Factor Authentication** | TOTP-based 2FA via Laravel Fortify                    | NIST 800-63B Level 2         |
| **Password Policy Enforcement** | 12+ chars, mixed case, numbers, symbols required      | NIST 800-63B, PCI-DSS 8.2.3  |
| **Password Breach Detection**   | Integration with Have I Been Pwned API (1M+ breaches) | NIST 800-63B Section 5.1.1.2 |
| **Password History**            | Last 5 passwords stored and checked                   | HIPAA, SOX compliance        |
| **Password Expiry**             | Configurable expiration (default: 90 days)            | PCI-DSS 8.2.4                |
| **Account Lockout**             | 5 failed attempts = 15 min lockout                    | OWASP ASVS 2.2.1             |
| **Session Stamping**            | Device fingerprint + browser validation               | Custom security layer        |
| **Remember Me**                 | Secure long-lived tokens with rotation                | Laravel Fortify standard     |

**Configuration:**

```env
SECURITY_PASSWORD_MIN_LENGTH=12
SECURITY_PASSWORD_REQUIRE_MIXED=true
SECURITY_PASSWORD_REQUIRE_NUMBERS=true
SECURITY_PASSWORD_REQUIRE_SYMBOLS=true
SECURITY_PASSWORD_REQUIRE_UNCOMPROMISED=true
SECURITY_PASSWORD_UNCOMPROMISED_THRESHOLD=0
SECURITY_PASSWORD_EXPIRY_DAYS=90
SECURITY_PASSWORD_HISTORY=5
SECURITY_LOCKOUT_ATTEMPTS=5
SECURITY_LOCKOUT_MINUTES=15
```

</details>

<details>
<summary><strong>2. Authorization & Access Control</strong></summary>

### 5-Level Role Hierarchy

| Level | Role           | Permissions                                        | Use Case                        |
| ----- | -------------- | -------------------------------------------------- | ------------------------------- |
| **1** | üî¥ Super Admin | All system permissions, unrestricted               | System administrators, founders |
| **2** | üü† Admin       | User management, reports, settings (except system) | IT managers, department heads   |
| **3** | üü° Manager     | Team management, approvals, departmental reports   | Team leads, project managers    |
| **4** | üü¢ Supervisor  | Task assignment, basic approvals                   | Shift supervisors, coordinators |
| **5** | üîµ User        | Own profile, assigned tasks, read access           | Regular users, employees        |

### Permission Structure

```php
// app/Policies/ExamplePolicy.php
public function update(User $user, Model $model)
{
    // Level 1-2: Full access
    if ($user->role_level <= 2) {
        return true;
    }

    // Level 3-4: Own department only
    if ($user->role_level <= 4 && $user->department_id === $model->department_id) {
        return true;
    }

    // Level 5: Own records only
    return $user->id === $model->user_id;
}
```

### Segregation of Duties (SOD)

- ‚úÖ No user can approve their own requests
- ‚úÖ No user can modify their own role
- ‚úÖ Sensitive actions require dual authorization (e.g., user deletion)
- ‚úÖ Audit logs are append-only (even Super Admin cannot delete)

</details>

<details>
<summary><strong>3. Tamper-Evident Audit Logging</strong></summary>

### Hash Chain Architecture

Every audit log entry contains:

```php
[
    'id' => 12345,
    'event_type' => 'user.login',
    'user_id' => 42,
    'ip_address' => '192.168.1.100',
    'user_agent' => 'Mozilla/5.0...',
    'data' => '{"status":"success","method":"email"}',
    'previous_hash' => 'a3f7b8c2...', // SHA-256 of previous entry
    'hash' => 'c4e9f1a7...',           // SHA-256 of (previous_hash + current_data)
    'created_at' => '2026-02-02 14:30:00'
]
```

### Integrity Verification

```bash
# Verify audit log integrity
docker compose exec app php artisan audit:verify

# Output:
# Verifying 10,523 audit log entries...
# ‚úÖ All entries verified successfully
# üîí No tampering detected
# Last verified: 2026-02-02 14:35:22
```

If tampering is detected:

```
‚ùå TAMPERING DETECTED!
Entry ID: 8421
Expected hash: c4e9f1a7b3d8f2e1...
Actual hash:   f1a7b3d8c4e9f2e1...
Action: ALERT SECURITY TEAM IMMEDIATELY
```

### Compliance Coverage

| Standard                 | Requirement                       | Implementation                   |
| ------------------------ | --------------------------------- | -------------------------------- |
| **SOX (Sarbanes-Oxley)** | Audit trail for financial systems | ‚úÖ All actions logged            |
| **HIPAA**                | Patient data access tracking      | ‚úÖ WHO accessed WHAT WHEN        |
| **GDPR Article 5(1)(f)** | Integrity and confidentiality     | ‚úÖ Tamper-evident logs           |
| **PCI-DSS 10.3**         | Audit trail for cardholder data   | ‚úÖ User ID, timestamp, IP logged |
| **ISO 27001 A.12.4**     | Event logging                     | ‚úÖ Security events captured      |

</details>

<details>
<summary><strong>4. Threat Detection & Prevention</strong></summary>

### Adaptive Risk Scoring

The system assigns risk points for suspicious behavior:

| Indicator                     | Risk Points   | Action at Threshold                |
| ----------------------------- | ------------- | ---------------------------------- |
| Suspicious User-Agent         | +6            | Risk ‚â• 8: Auto-block IP for 90 min |
| Missing User-Agent            | +3            | Risk ‚â• 10: Permanent block + alert |
| Multiple X-Forwarded-For IPs  | +2/IP (max 3) | Log for manual review              |
| Excessive query string length | +2            | Rate limit response                |
| Large payload size (>256 KB)  | +3            | Reject request                     |
| SQL injection patterns        | +5            | Block + alert security team        |
| Path traversal patterns       | +5            | Block + alert security team        |
| Burst requests (>90 in 60s)   | +6            | Temporary throttle                 |

**Configuration:**

```env
SECURITY_THREAT_ENABLED=true
SECURITY_THREAT_AGGRESSIVE=true
SECURITY_RISK_THRESHOLD=8
SECURITY_RISK_DECAY_MINUTES=30
SECURITY_AUTO_BLOCK=true
SECURITY_USER_BLOCK_MINUTES=90
SECURITY_IP_BLOCK_MINUTES=45
```

### Rate Limiting Strategy

| Endpoint Type    | Limit        | Window   | Punishment            |
| ---------------- | ------------ | -------- | --------------------- |
| **Login**        | 5 attempts   | 1 minute | 15 min lockout        |
| **API General**  | 60 requests  | 1 minute | 429 Too Many Requests |
| **Admin Panel**  | 120 requests | 1 minute | Temporary IP block    |
| **Public Pages** | 300 requests | 1 minute | Progressive delay     |

```php
// routes/web.php
Route::middleware(['throttle:60,1'])->group(function () {
    // API routes limited to 60/min
});

Route::post('/login')->middleware('throttle:5,1'); // 5 attempts per minute
```

</details>

<details>
<summary><strong>5. Security Headers (OWASP)</strong></summary>

All responses include these security headers (configured in `docker/nginx/default.conf`):

```nginx
# Prevent clickjacking attacks
add_header X-Frame-Options "SAMEORIGIN" always;

# Prevent MIME type sniffing
add_header X-Content-Type-Options "nosniff" always;

# XSS Protection for legacy browsers
add_header X-XSS-Protection "1; mode=block" always;

# Control referrer information
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Content Security Policy (CSP)
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: https: blob:; connect-src 'self' ws: wss:; frame-ancestors 'self'; form-action 'self'; base-uri 'self';" always;

# Permissions Policy (formerly Feature-Policy)
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=()" always;

# HTTP Strict Transport Security (HSTS) - enable after SSL setup
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
```

**Verify headers:**

```bash
curl -I http://localhost:8080 | grep -E 'X-Frame|X-Content|CSP|Referrer'
```

</details>

<details>
<summary><strong>6. Secure Session Management</strong></summary>

### Session Configuration

```env
SESSION_DRIVER=redis           # Redis for distributed sessions
SESSION_LIFETIME=120           # 2 hours idle timeout
SESSION_ENCRYPT=false          # Set true for sensitive data
SESSION_COOKIE=laravel_session
SESSION_SECURE_COOKIE=true     # HTTPS only (production)
SESSION_HTTP_ONLY=true         # Prevent XSS access
SESSION_SAME_SITE=lax          # CSRF protection
```

### Features

- **Session Stamping**: Unique stamp per login, invalidated on logout or password change
- **Device Fingerprinting**: Browser + OS + IP tracked
- **Concurrent Session Limits**: Max 3 active sessions per user (configurable)
- **Automatic Expiration**: Idle timeout + absolute timeout (8 hours)
- **Session Hijacking Detection**: IP change alerts

### Track Active Sessions

```bash
docker compose exec app php artisan user:sessions
```

</details>

<details>
<summary><strong>7. Input Validation & Output Encoding</strong></summary>

### CSRF Protection

```blade
<!-- All forms automatically protected -->
<form method="POST" action="/submit">
    @csrf
    <!-- Laravel automatically generates and validates token -->
</form>
```

### XSS Prevention

```blade
<!-- Auto-escaping in Blade templates -->
{{ $user->name }}              <!-- Escaped (safe) -->
{!! $trustedHtml !!}           <!-- Unescaped (use cautiously) -->

<!-- Filament automatically sanitizes user input -->
```

### SQL Injection Prevention

```php
// Eloquent ORM prevents SQL injection
User::where('email', $request->email)->first();  // ‚úÖ Safe

// Raw queries use parameter binding
DB::select('SELECT * FROM users WHERE email = ?', [$email]);  // ‚úÖ Safe
```

</details>

### üîê Security Checklist (Pre-Production)

Before deploying to production, verify:

- [x] **Environment Configuration**
    - [ ] `APP_ENV=production`
    - [ ] `APP_DEBUG=false`
    - [ ] `APP_KEY` is unique and never committed to Git
    - [ ] Strong database passwords (20+ random chars)
    - [ ] Redis password configured
    - [ ] All API keys in `.env`, not hardcoded

- [x] **HTTPS & SSL**
    - [ ] Valid SSL certificate installed (Let's Encrypt or commercial)
    - [ ] HTTP redirects to HTTPS
    - [ ] HSTS header enabled (`Strict-Transport-Security`)
    - [ ] Certificate auto-renewal configured

- [x] **Web Server Security**
    - [ ] Hide server version (`server_tokens off` in Nginx)
    - [ ] Security headers configured (see above)
    - [ ] Disable directory listing
    - [ ] Block access to `.env`, `.git`, `composer.json`
    - [ ] Limit request body size (prevent DoS)

- [x] **Database Security**
    - [ ] Database accessible only from app container/server
    - [ ] No `root` login from app (use dedicated user)
    - [ ] Regular backups configured (daily recommended)
    - [ ] Backup encryption enabled

- [x] **Application Security**
    - [ ] All dependencies updated (`composer update`, `npm update`)
    - [ ] Composer audit passed (`composer audit`)
    - [ ] npm audit passed (`npm audit fix`)
    - [ ] Config/route/view caches enabled (`php artisan optimize`)
    - [ ] Storage permissions correct (755 for directories, 644 for files)

- [x] **Monitoring & Logging**
    - [ ] Error logging enabled (Laravel log level: `error` in production)
    - [ ] Log rotation configured (prevent disk fill)
    - [ ] Prometheus + Grafana dashboards reviewed
    - [ ] Alertmanager configured for critical alerts
    - [ ] Uptime monitoring service active (UptimeRobot, Pingdom, etc.)

- [x] **Backup & Recovery**
    - [ ] Automated database backups (cron job or service)
    - [ ] Backup restore procedure tested
    - [ ] Off-site backup storage (S3, Google Drive, etc.)
    - [ ] Disaster recovery plan documented

### üö® Security Incident Response

If you detect a security issue:

1. **Immediate Actions:**

    ```bash
    # Enable maintenance mode
    docker compose exec app php artisan down --secret="emergency-bypass-token"

    # Check audit logs for suspicious activity
    docker compose exec app php artisan audit:review --last-hour

    # Block suspicious IPs
    docker compose exec app php artisan security:block-ip <IP_ADDRESS>
    ```

2. **Investigate:**
    - Review audit logs: `storage/logs/laravel.log`
    - Check database for unauthorized changes
    - Verify audit log integrity: `php artisan audit:verify`

3. **Remediate:**
    - Force logout all users: `php artisan auth:clear-sessions`
    - Reset compromised passwords
    - Rotate application key if exposed
    - Patch vulnerability

4. **Notify:**
    - Inform affected users
    - Report to authorities if required (GDPR breach notification)

### üõ†Ô∏è Security Testing Tools

```bash
# Check for known vulnerabilities in dependencies
docker compose exec app composer audit

# npm security audit
docker compose exec node npm audit

# Check PHP security advisories
docker compose exec app local-php-security-checker

# Scan for common web vulnerabilities (install nikto)
nikto -h http://localhost:8080

# SSL/TLS testing (after HTTPS setup)
nmap --script ssl-enum-ciphers -p 443 yourdomain.com
```

### üìö Security Resources

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [NIST 800-63B Password Guidelines](https://pages.nist.gov/800-63-3/sp800-63b.html)
- [Laravel Security Best Practices](https://laravel.com/docs/master/security)
- [Filament Security Considerations](https://filamentphp.com/docs/security)
- [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks)

---

## ü§ñ AI Intelligence

### Supported Providers

| Provider       | Models                           | Use Case                        |
| -------------- | -------------------------------- | ------------------------------- |
| **OpenAI**     | GPT-4o, GPT-4o-mini              | General purpose, high quality   |
| **Anthropic**  | Claude 3.5 Sonnet, Claude 3 Opus | Complex reasoning, long context |
| **Google**     | Gemini Pro, Gemini Flash         | Multimodal, fast responses      |
| **Groq**       | Llama 3, Mixtral                 | Ultra-fast inference            |
| **DeepSeek**   | DeepSeek Chat, Coder             | Cost-effective, coding          |
| **Mistral**    | Mistral Large, Medium            | European compliance             |
| **OpenRouter** | 100+ models                      | Model aggregation               |
| **Cohere**     | Command R+                       | Enterprise features             |
| **Together**   | Open-source models               | Self-hosted compatible          |

### AI Configuration

Configure AI providers in the admin panel under **Settings ‚Üí AI Configuration** or via environment variables:

```env
# Primary AI Provider
AI_PROVIDER=openai
AI_MODEL=gpt-4o-mini
AI_TEMPERATURE=0.7
AI_MAX_TOKENS=4096

# Provider API Keys
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_AI_API_KEY=...
GROQ_API_KEY=gsk_...
```

### Failover Configuration

The system automatically fails over to backup providers:

```
Primary ‚Üí Secondary ‚Üí Tertiary ‚Üí Fallback
OpenAI  ‚Üí Anthropic ‚Üí Groq     ‚Üí DeepSeek
```

---

## ‚öôÔ∏è Configuration

### Environment Variables

<details>
<summary><strong>Core Application</strong></summary>

```env
APP_NAME="Creative Trees"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com

# Timezone
APP_TIMEZONE=Asia/Jakarta
```

</details>

<details>
<summary><strong>Database</strong></summary>

```env
DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=creativetrees
DB_USERNAME=creativetrees
DB_PASSWORD=your_secure_password
```

</details>

<details>
<summary><strong>Redis & Cache</strong></summary>

```env
REDIS_HOST=redis
REDIS_PASSWORD=null
REDIS_PORT=6379

CACHE_DRIVER=redis
SESSION_DRIVER=redis
QUEUE_CONNECTION=redis
```

</details>

<details>
<summary><strong>Mail</strong></summary>

```env
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="noreply@creativetrees.com"
MAIL_FROM_NAME="${APP_NAME}"
```

</details>

---

## ÔøΩ Operations & Maintenance

### Daily Operations

```bash
# Health check - verify all services are running
docker compose ps
docker compose exec app php artisan about

# Application health endpoint
curl http://localhost:8080/up

# Check system status
docker compose exec app php artisan health:check

# Clear application caches
docker compose exec app php artisan optimize:clear

# Process queue manually (if queue worker is down)
docker compose exec app php artisan queue:work --tries=3 --timeout=90
```

### Weekly Operations

```bash
# Update composer dependencies (check for security updates)
docker compose exec app composer update --no-dev

# Run security audit
docker compose exec app composer audit

# npm security audit
docker compose exec node npm audit

# Verify audit log integrity
docker compose exec app php artisan audit:verify

# Clean up old logs (keep last 30 days)
docker compose exec app php artisan log:clean --days=30
```

### Monthly Operations

```bash
# Full system backup (database + files)
./scripts/backup-full.sh

# Review security alerts
docker compose exec app php artisan security:review-alerts

# Update Docker images
docker compose pull
docker compose up -d

# Database optimization
docker compose exec app php artisan db:optimize

# Review failed jobs
docker compose exec app php artisan queue:failed
docker compose exec app php artisan queue:retry all
```

### Backup Procedures

#### Automated Database Backup

```bash
# Create backup script: scripts/backup-database.sh
#!/bin/bash
BACKUP_DIR="/backups/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="creativetrees_${DATE}.sql"

mkdir -p $BACKUP_DIR

docker compose exec -T mysql mysqldump \
  -u root \
  -p${DB_ROOT_PASSWORD} \
  --single-transaction \
  --routines \
  --triggers \
  creativetrees > "${BACKUP_DIR}/${BACKUP_FILE}"

# Compress backup
gzip "${BACKUP_DIR}/${BACKUP_FILE}"

# Upload to S3 (optional)
aws s3 cp "${BACKUP_DIR}/${BACKUP_FILE}.gz" s3://your-bucket/backups/

# Keep only last 7 days
find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete

echo "‚úÖ Backup completed: ${BACKUP_FILE}.gz"
```

#### Application Files Backup

```bash
# Create backup script: scripts/backup-files.sh
#!/bin/bash
BACKUP_DIR="/backups/files"
DATE=$(date +%Y%m%d_%H%M%S)
APP_DIR="/var/www/creativetrees"

mkdir -p $BACKUP_DIR

# Backup storage directory
tar -czf "${BACKUP_DIR}/storage_${DATE}.tar.gz" \
  -C $APP_DIR storage \
  --exclude=storage/framework/cache \
  --exclude=storage/framework/sessions \
  --exclude=storage/logs

# Backup uploads
tar -czf "${BACKUP_DIR}/uploads_${DATE}.tar.gz" \
  -C $APP_DIR public/uploads

# Keep only last 14 days
find $BACKUP_DIR -name "*.tar.gz" -mtime +14 -delete

echo "‚úÖ Files backup completed"
```

#### Setup Automated Cron

```bash
# Add to crontab (crontab -e)

# Database backup every day at 2 AM
0 2 * * * /var/www/creativetrees/scripts/backup-database.sh >> /var/log/backup.log 2>&1

# Files backup every day at 3 AM
0 3 * * * /var/www/creativetrees/scripts/backup-files.sh >> /var/log/backup.log 2>&1

# Weekly full backup every Sunday at 4 AM
0 4 * * 0 /var/www/creativetrees/scripts/backup-full.sh >> /var/log/backup.log 2>&1
```

### Queue Management

```bash
# Check queue status
docker compose exec app php artisan queue:monitor

# Start queue worker with specific configuration
docker compose exec app php artisan queue:work \
  --queue=high,default,low \
  --tries=3 \
  --timeout=90 \
  --sleep=3

# Process specific queue
docker compose exec app php artisan queue:work --queue=emails

# Restart all queue workers (picks up code changes)
docker compose exec app php artisan queue:restart

# View failed jobs
docker compose exec app php artisan queue:failed

# Retry failed job
docker compose exec app php artisan queue:retry <job-id>

# Retry all failed jobs
docker compose exec app php artisan queue:retry all

# Forget failed job
docker compose exec app php artisan queue:forget <job-id>

# Flush all failed jobs (‚ö†Ô∏è permanent deletion)
docker compose exec app php artisan queue:flush
```

### Scheduler Verification

```bash
# Verify scheduler is running
docker compose logs -f scheduler

# Test schedule execution manually
docker compose exec app php artisan schedule:run

# List all scheduled tasks
docker compose exec app php artisan schedule:list

# Test specific scheduled task
docker compose exec app php artisan schedule:test

# Monitor scheduler
docker compose exec app php artisan schedule:work  # Foreground mode
```

### Cache Management

```bash
# Clear all caches
docker compose exec app php artisan optimize:clear

# Clear specific caches
docker compose exec app php artisan cache:clear       # Application cache
docker compose exec app php artisan config:clear      # Configuration cache
docker compose exec app php artisan route:clear       # Route cache
docker compose exec app php artisan view:clear        # Compiled views
docker compose exec app php artisan event:clear       # Event cache

# Rebuild caches (production optimization)
docker compose exec app php artisan config:cache
docker compose exec app php artisan route:cache
docker compose exec app php artisan view:cache
docker compose exec app php artisan event:cache
docker compose exec app php artisan optimize

# Clear Redis cache (all keys)
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 FLUSHDB

# Clear specific cache tags
docker compose exec app php artisan cache:forget cache_key_name
```

### Log Management

```bash
# View real-time Laravel logs
docker compose exec app tail -f storage/logs/laravel.log

# Search logs for errors
docker compose exec app grep -i "error" storage/logs/laravel.log

# View logs from specific date
docker compose exec app grep "2026-02-02" storage/logs/laravel-2026-02-02.log

# Truncate logs (‚ö†Ô∏è use with caution)
docker compose exec app truncate -s 0 storage/logs/laravel.log

# Archive old logs
docker compose exec app tar -czf storage/logs/archive/logs_$(date +%Y%m).tar.gz storage/logs/*.log
docker compose exec app rm storage/logs/laravel-*.log
```

### Monitoring

Access monitoring dashboards:

| Service           | URL                   | Default Credentials                         |
| ----------------- | --------------------- | ------------------------------------------- |
| **Grafana**       | http://localhost:3000 | admin / creativetrees_grafana_2026          |
| **Prometheus**    | http://localhost:9090 | No authentication                           |
| **Alertmanager**  | http://localhost:9093 | No authentication                           |
| **phpMyAdmin**    | http://localhost:8888 | DB credentials from .env                    |
| **Redis Insight** | http://localhost:5540 | No authentication (add connection manually) |

#### Grafana Dashboards

Pre-configured dashboards available:

1. **Application Overview** - Request rates, response times, error rates
2. **Infrastructure** - CPU, memory, disk usage per container
3. **Database Performance** - Query counts, slow queries, connections
4. **Redis Metrics** - Hit rate, memory usage, evictions
5. **Queue Monitoring** - Job throughput, failed jobs, queue depth

#### Custom Alerts

Configure alerts in `docker/monitoring/alertmanager.yml`:

```yaml
route:
    receiver: "team-emails"
    group_by: ["alertname", "cluster"]
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h

receivers:
    - name: "team-emails"
      email_configs:
          - to: "ops-team@yourdomain.com"
            from: "alertmanager@yourdomain.com"
            smarthost: "smtp.gmail.com:587"
            auth_username: "your-email@gmail.com"
            auth_password: "your-app-password"

    - name: "slack-notifications"
      slack_configs:
          - api_url: "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
            channel: "#ops-alerts"
            title: "{{ .GroupLabels.alertname }}"
```

### System Maintenance

```bash
# Enable maintenance mode
docker compose exec app php artisan down --refresh=15 --retry=60

# Enable with bypass secret
docker compose exec app php artisan down --secret="emergency-bypass-2026"

# Access during maintenance
# Visit: http://localhost:8080/emergency-bypass-2026

# Disable maintenance mode
docker compose exec app php artisan up

# Check if in maintenance mode
docker compose exec app php artisan isdown
```

### Resource Monitoring

```bash
# Monitor container resource usage
docker stats

# View disk usage
docker system df

# Clean up unused resources
docker system prune -a --volumes

# Check database size
docker compose exec mysql mysql -u root -p -e "
SELECT
  table_schema AS 'Database',
  ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)'
FROM information_schema.tables
GROUP BY table_schema;"

# Check Redis memory usage
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 INFO memory
```

---

## ‚ö° Performance & Optimization

### Performance Benchmarks

| Metric                           | Target        | Excellent     | Current       |
| -------------------------------- | ------------- | ------------- | ------------- |
| **Average Response Time**        | <200ms        | <100ms        | ~150ms        |
| **Database Query Time**          | <50ms         | <20ms         | ~30ms         |
| **Redis Cache Hit Rate**         | >85%          | >95%          | ~92%          |
| **Queue Processing**             | >100 jobs/min | >500 jobs/min | ~300 jobs/min |
| **Concurrent Users**             | 1000+         | 5000+         | ~2500         |
| **Memory Usage (per container)** | <512MB        | <256MB        | ~384MB        |

### Laravel Optimization

<details>
<summary><strong>1. Caching Strategies</strong></summary>

```bash
# Production cache optimization
docker compose exec app php artisan config:cache
docker compose exec app php artisan route:cache
docker compose exec app php artisan view:cache
docker compose exec app php artisan event:cache
docker compose exec app php artisan optimize

# Development (disable caching for hot reload)
docker compose exec app php artisan optimize:clear
```

#### Query Caching

```php
// Cache database queries
use Illuminate\Support\Facades\Cache;

// Cache for 1 hour
$users = Cache::remember('users.active', 3600, function () {
    return User::where('status', 'active')->get();
});

// Cache with tags (easier invalidation)
$posts = Cache::tags(['posts', 'homepage'])->remember('posts.recent', 3600, function () {
    return Post::latest()->limit(10)->get();
});

// Invalidate tagged cache
Cache::tags(['posts'])->flush();
```

#### Model Caching

```php
// app/Models/User.php
use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    protected $cacheFor = 3600; // 1 hour

    public static function boot()
    {
        parent::boot();

        // Clear cache on model events
        static::saved(function ($model) {
            Cache::forget("user.{$model->id}");
        });
    }
}
```

</details>

<details>
<summary><strong>2. Database Optimization</strong></summary>

#### Indexing Strategy

```sql
-- Add indexes for frequently queried columns
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at);
CREATE INDEX idx_user_login_activity_user_id ON user_login_activity(user_id);

-- Composite indexes for common queries
CREATE INDEX idx_audit_logs_user_created ON audit_logs(user_id, created_at);

-- Check existing indexes
SHOW INDEX FROM users;
```

#### Query Optimization

```php
// ‚ùå N+1 Query Problem
$users = User::all();
foreach ($users as $user) {
    echo $user->posts->count(); // Queries on every iteration
}

// ‚úÖ Eager Loading
$users = User::with('posts')->get();
foreach ($users as $user) {
    echo $user->posts->count(); // No additional queries
}

// ‚úÖ Lazy Eager Loading
$users = User::all();
$users->load('posts');

// ‚úÖ Count optimization
$users = User::withCount('posts')->get();
foreach ($users as $user) {
    echo $user->posts_count; // Efficient COUNT query
}
```

#### Database Query Monitoring

```bash
# Enable query log
docker compose exec app php artisan db:monitor

# Log slow queries (>500ms)
# config/logging.php - already configured
```

```php
// config/database.php
'mysql' => [
    // ... other config
    'slow_query_log' => env('DB_SLOW_QUERY_LOG', true),
    'slow_query_time' => env('DB_SLOW_QUERY_TIME', 0.5), // 500ms
],
```

</details>

<details>
<summary><strong>3. OpCache Configuration</strong></summary>

OpCache is already configured in `docker/php/opcache.ini`:

```ini
opcache.enable=1
opcache.memory_consumption=256
opcache.interned_strings_buffer=16
opcache.max_accelerated_files=10000
opcache.revalidate_freq=0
opcache.validate_timestamps=1
opcache.fast_shutdown=1
opcache.enable_cli=1
```

**Production settings:**

```ini
opcache.revalidate_freq=60
opcache.validate_timestamps=0  # Disable for max performance
```

```bash
# Verify OpCache status
docker compose exec app php -r "var_dump(opcache_get_status());"

# Clear OpCache (requires restart)
docker compose restart app
```

</details>

<details>
<summary><strong>4. Redis Optimization</strong></summary>

#### Redis Configuration

```bash
# Check Redis memory usage
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 INFO memory

# Monitor cache hit rate
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 INFO stats | grep keyspace
```

#### Cache Strategy

```php
// config/cache.php
'default' => env('CACHE_DRIVER', 'redis'),

'stores' => [
    'redis' => [
        'driver' => 'redis',
        'connection' => 'cache',
        'lock_connection' => 'default',
    ],
],
```

#### Session Optimization

```env
SESSION_DRIVER=redis
SESSION_LIFETIME=120
SESSION_ENCRYPT=false  # Set true if handling sensitive data
```

</details>

<details>
<summary><strong>5. Asset Optimization</strong></summary>

#### Vite Build Optimization

```javascript
// vite.config.js
import { defineConfig } from "vite";
import laravel from "laravel-vite-plugin";

export default defineConfig({
    plugins: [
        laravel({
            input: ["resources/css/app.css", "resources/js/app.js"],
            refresh: true,
        }),
    ],
    build: {
        manifest: true,
        outDir: "public/build",
        rollupOptions: {
            output: {
                manualChunks: {
                    vendor: ["alpinejs", "axios"],
                },
            },
        },
        // Minification
        minify: "terser",
        terserOptions: {
            compress: {
                drop_console: true,
                drop_debugger: true,
            },
        },
    },
});
```

#### Image Optimization

```bash
# Install image optimization packages
docker compose exec app composer require intervention/image

# Optimize uploaded images
docker compose exec app php artisan image:optimize
```

</details>

<details>
<summary><strong>6. HTTP/2 & Compression</strong></summary>

#### Nginx Gzip Configuration

Already configured in `docker/nginx/default.conf`:

```nginx
# Gzip compression
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml;
```

#### HTTP/2 Support (Production)

```nginx
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    # SSL configuration
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
}
```

</details>

### Performance Testing

```bash
# Install Apache Bench
sudo apt install apache2-utils

# Basic load test (100 requests, 10 concurrent)
ab -n 100 -c 10 http://localhost:8080/

# POST request test
ab -n 100 -c 10 -p post.txt -T application/json http://localhost:8080/api/endpoint

# Using Artillery for advanced testing
npm install -g artillery

# Run load test
artillery quick --count 10 --num 100 http://localhost:8080/
```

#### Load Testing Configuration

```yaml
# artillery.yml
config:
    target: "http://localhost:8080"
    phases:
        - duration: 60
          arrivalRate: 10
          name: "Warm up"
        - duration: 120
          arrivalRate: 50
          name: "Sustained load"
        - duration: 60
          arrivalRate: 100
          name: "Spike test"

scenarios:
    - name: "Homepage visit"
      flow:
          - get:
                url: "/"
    - name: "API request"
      flow:
          - post:
                url: "/api/users"
                json:
                    name: "Test User"
                    email: "test@example.com"
```

```bash
# Run Artillery test
artillery run artillery.yml
```

### Performance Monitoring Commands

```bash
# Monitor PHP-FPM status
docker compose exec app php-fpm -i | grep -E 'pool|max_children'

# Check MySQL performance
docker compose exec mysql mysql -u root -p -e "SHOW FULL PROCESSLIST;"
docker compose exec mysql mysql -u root -p -e "SHOW ENGINE INNODB STATUS\G"

# Monitor Redis performance
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 --latency
docker compose exec redis redis-cli -a creativetrees_redis_secure_2026 --stat

# Container resource usage
docker stats --no-stream
```

---

## üß™ Testing & Quality Assurance

### Testing Stack

| Type               | Framework       | Coverage | Purpose                         |
| ------------------ | --------------- | -------- | ------------------------------- |
| **Unit Tests**     | PHPUnit 10+     | ~80%     | Test individual methods/classes |
| **Feature Tests**  | Laravel Testing | ~70%     | Test HTTP endpoints, workflows  |
| **Browser Tests**  | Laravel Dusk    | ~40%     | Test JavaScript interactions    |
| **API Tests**      | Pest PHP        | ~85%     | Test API endpoints              |
| **Security Tests** | OWASP ZAP       | Manual   | Vulnerability scanning          |

### Running Tests

```bash
# Run all tests
docker compose exec app php artisan test

# Run specific test file
docker compose exec app php artisan test --filter UserTest

# Run with coverage (requires Xdebug)
docker compose exec app php artisan test --coverage

# Run parallel tests (faster)
docker compose exec app php artisan test --parallel

# Run specific test suite
docker compose exec app php artisan test --testsuite=Feature
```

### Test Examples

<details>
<summary><strong>Unit Test Example</strong></summary>

```php
<?php
// tests/Unit/AuditHasherTest.php

namespace Tests\Unit;

use Tests\TestCase;
use App\Support\AuditHasher;

class AuditHasherTest extends TestCase
{
    public function test_hash_generation_is_consistent(): void
    {
        $data = ['user_id' => 1, 'action' => 'login'];
        $previousHash = 'abc123';

        $hash1 = AuditHasher::generateHash($data, $previousHash);
        $hash2 = AuditHasher::generateHash($data, $previousHash);

        $this->assertEquals($hash1, $hash2);
    }

    public function test_hash_verification_detects_tampering(): void
    {
        $entry = [
            'data' => ['user_id' => 1],
            'previous_hash' => 'abc123',
            'hash' => 'tampered_hash'
        ];

        $isValid = AuditHasher::verifyHash($entry);

        $this->assertFalse($isValid);
    }
}
```

</details>

<details>
<summary><strong>Feature Test Example</strong></summary>

```php
<?php
// tests/Feature/AuthenticationTest.php

namespace Tests\Feature;

use Tests\TestCase;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;

class AuthenticationTest extends TestCase
{
    use RefreshDatabase;

    public function test_user_can_login_with_valid_credentials(): void
    {
        $user = User::factory()->create([
            'email' => 'test@example.com',
            'password' => bcrypt('password123'),
        ]);

        $response = $this->post('/login', [
            'email' => 'test@example.com',
            'password' => 'password123',
        ]);

        $response->assertRedirect('/admin');
        $this->assertAuthenticatedAs($user);
    }

    public function test_user_cannot_login_with_invalid_credentials(): void
    {
        $user = User::factory()->create();

        $response = $this->post('/login', [
            'email' => $user->email,
            'password' => 'wrong-password',
        ]);

        $response->assertSessionHasErrors();
        $this->assertGuest();
    }

    public function test_account_lockout_after_failed_attempts(): void
    {
        $user = User::factory()->create();

        // Attempt 5 failed logins
        for ($i = 0; $i < 5; $i++) {
            $this->post('/login', [
                'email' => $user->email,
                'password' => 'wrong-password',
            ]);
        }

        // 6th attempt should be blocked
        $response = $this->post('/login', [
            'email' => $user->email,
            'password' => 'wrong-password',
        ]);

        $response->assertStatus(429); // Too Many Requests
    }
}
```

</details>

<details>
<summary><strong>API Test Example (Pest)</strong></summary>

```php
<?php
// tests/Pest/Api/UserApiTest.php

use App\Models\User;

test('api returns user list for authenticated user', function () {
    $user = User::factory()->create();

    $response = $this->actingAs($user, 'sanctum')
        ->getJson('/api/users');

    $response->assertStatus(200)
        ->assertJsonStructure([
            'data' => [
                '*' => ['id', 'name', 'email', 'created_at']
            ]
        ]);
});

test('api requires authentication', function () {
    $response = $this->getJson('/api/users');

    $response->assertStatus(401);
});

test('api rate limiting works', function () {
    $user = User::factory()->create();

    // Make 61 requests (limit is 60/minute)
    for ($i = 0; $i < 61; $i++) {
        $response = $this->actingAs($user, 'sanctum')
            ->getJson('/api/users');
    }

    expect($response->status())->toBe(429);
});
```

</details>

### Code Quality Tools

```bash
# PHP CS Fixer (code style)
docker compose exec app vendor/bin/php-cs-fixer fix

# PHPStan (static analysis)
docker compose exec app vendor/bin/phpstan analyse

# Psalm (static analysis alternative)
docker compose exec app vendor/bin/psalm

# PHP Mess Detector
docker compose exec app vendor/bin/phpmd app text cleancode,codesize,controversial,design,naming,unusedcode

# Check for security vulnerabilities
docker compose exec app composer audit
```

### Continuous Integration Example

```yaml
# .github/workflows/tests.yml
name: Tests

on:
    push:
        branches: [main, develop]
    pull_request:
        branches: [main, develop]

jobs:
    test:
        runs-on: ubuntu-latest

        services:
            mysql:
                image: mysql:8.0
                env:
                    MYSQL_ROOT_PASSWORD: root
                    MYSQL_DATABASE: testing
                options: >-
                    --health-cmd="mysqladmin ping"
                    --health-interval=10s
                    --health-timeout=5s
                    --health-retries=3

            redis:
                image: redis:7-alpine
                options: >-
                    --health-cmd="redis-cli ping"
                    --health-interval=10s
                    --health-timeout=5s
                    --health-retries=3

        steps:
            - uses: actions/checkout@v3

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: "8.4"
                  extensions: mbstring, xml, ctype, json, bcmath, redis
                  coverage: xdebug

            - name: Install dependencies
              run: composer install --prefer-dist --no-interaction

            - name: Copy .env
              run: cp .env.testing .env

            - name: Generate key
              run: php artisan key:generate

            - name: Run migrations
              run: php artisan migrate --force

            - name: Run tests
              run: php artisan test --coverage --min=80

            - name: Upload coverage
              uses: codecov/codecov-action@v3
```

---

## üì° API Documentation

### API Overview

Creative Trees provides RESTful APIs for integration with external systems.

**Base URL:** `https://your-domain.com/api/v1`

**Authentication:** Laravel Sanctum (Token-based)

### Authentication

```bash
# Login and get token
curl -X POST https://your-domain.com/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "your-password"
  }'

# Response:
{
  "token": "1|abcdef123456...",
  "user": {
    "id": 1,
    "name": "Admin User",
    "email": "admin@example.com"
  }
}

# Use token in subsequent requests
curl -X GET https://your-domain.com/api/v1/users \
  -H "Authorization: Bearer 1|abcdef123456..." \
  -H "Accept: application/json"
```

### API Endpoints

<details>
<summary><strong>User Management</strong></summary>

#### List Users

```http
GET /api/v1/users
```

**Query Parameters:**

- `page` (int) - Page number (default: 1)
- `per_page` (int) - Items per page (default: 15, max: 100)
- `search` (string) - Search by name or email
- `role` (string) - Filter by role level
- `status` (string) - Filter by account status

**Example:**

```bash
curl -X GET "https://your-domain.com/api/v1/users?page=1&per_page=20&role=admin" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

**Response:**

```json
{
    "data": [
        {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com",
            "role_level": 2,
            "status": "active",
            "created_at": "2026-01-15T10:30:00.000000Z",
            "updated_at": "2026-02-02T14:20:00.000000Z"
        }
    ],
    "links": {
        "first": "https://your-domain.com/api/v1/users?page=1",
        "last": "https://your-domain.com/api/v1/users?page=5",
        "prev": null,
        "next": "https://your-domain.com/api/v1/users?page=2"
    },
    "meta": {
        "current_page": 1,
        "from": 1,
        "last_page": 5,
        "per_page": 20,
        "to": 20,
        "total": 95
    }
}
```

#### Get User

```http
GET /api/v1/users/{id}
```

```bash
curl -X GET "https://your-domain.com/api/v1/users/1" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

#### Create User

```http
POST /api/v1/users
```

**Request Body:**

```json
{
    "name": "Jane Smith",
    "email": "jane@example.com",
    "password": "SecurePass123!",
    "password_confirmation": "SecurePass123!",
    "role_level": 3,
    "status": "active"
}
```

```bash
curl -X POST "https://your-domain.com/api/v1/users" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "name": "Jane Smith",
    "email": "jane@example.com",
    "password": "SecurePass123!",
    "password_confirmation": "SecurePass123!",
    "role_level": 3
  }'
```

#### Update User

```http
PUT /api/v1/users/{id}
PATCH /api/v1/users/{id}
```

```bash
curl -X PUT "https://your-domain.com/api/v1/users/1" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "John Updated",
    "status": "suspended"
  }'
```

#### Delete User

```http
DELETE /api/v1/users/{id}
```

```bash
curl -X DELETE "https://your-domain.com/api/v1/users/1" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

</details>

<details>
<summary><strong>Audit Logs</strong></summary>

#### List Audit Logs

```http
GET /api/v1/audit-logs
```

**Query Parameters:**

- `user_id` (int) - Filter by user
- `event_type` (string) - Filter by event type
- `from_date` (date) - Start date (Y-m-d)
- `to_date` (date) - End date (Y-m-d)

```bash
curl -X GET "https://your-domain.com/api/v1/audit-logs?user_id=1&from_date=2026-02-01" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

#### Verify Audit Integrity

```http
POST /api/v1/audit-logs/verify
```

```bash
curl -X POST "https://your-domain.com/api/v1/audit-logs/verify" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Accept: application/json"
```

**Response:**

```json
{
    "status": "success",
    "verified": true,
    "total_entries": 10523,
    "tampered_entries": 0,
    "last_verified_at": "2026-02-02T14:35:22.000000Z"
}
```

</details>

<details>
<summary><strong>AI Orchestration</strong></summary>

#### Send AI Request

```http
POST /api/v1/ai/chat
```

**Request Body:**

```json
{
    "provider": "openai",
    "model": "gpt-4o-mini",
    "messages": [
        {
            "role": "user",
            "content": "Explain Laravel in simple terms"
        }
    ],
    "temperature": 0.7,
    "max_tokens": 500
}
```

```bash
curl -X POST "https://your-domain.com/api/v1/ai/chat" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "openai",
    "model": "gpt-4o-mini",
    "messages": [
      {"role": "user", "content": "Explain Laravel in simple terms"}
    ]
  }'
```

**Response:**

```json
{
    "provider": "openai",
    "model": "gpt-4o-mini",
    "response": "Laravel is a web application framework...",
    "tokens_used": 245,
    "cost": 0.00012,
    "latency_ms": 456
}
```

#### List AI Providers

```http
GET /api/v1/ai/providers
```

</details>

### Rate Limiting

| Endpoint            | Limit        | Window   |
| ------------------- | ------------ | -------- |
| **Authentication**  | 5 requests   | 1 minute |
| **General API**     | 60 requests  | 1 minute |
| **Admin Endpoints** | 120 requests | 1 minute |
| **AI Requests**     | 30 requests  | 1 minute |

**Rate Limit Headers:**

```
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 45
X-RateLimit-Reset: 1643811600
```

### Error Responses

```json
{
    "message": "The given data was invalid.",
    "errors": {
        "email": ["The email field is required."],
        "password": ["The password must be at least 12 characters."]
    }
}
```

**HTTP Status Codes:**

| Code | Meaning                          |
| ---- | -------------------------------- |
| 200  | Success                          |
| 201  | Created                          |
| 204  | No Content (successful deletion) |
| 400  | Bad Request                      |
| 401  | Unauthorized                     |
| 403  | Forbidden                        |
| 404  | Not Found                        |
| 422  | Validation Error                 |
| 429  | Too Many Requests (rate limited) |
| 500  | Internal Server Error            |

### Postman Collection

```bash
# Import Postman collection
curl -o CreativeTrees.postman_collection.json \
  https://raw.githubusercontent.com/Halfirzzha/Creativetree-Production/main/docs/postman/collection.json
```

---

## üö¢ Deployment Strategies

### Deployment Options Matrix

| Strategy              | Downtime | Complexity | Rollback Speed | Best For                              |
| --------------------- | -------- | ---------- | -------------- | ------------------------------------- |
| **Simple Deployment** | 30s-5min | Low        | Slow (manual)  | Small sites, scheduled maintenance    |
| **Blue-Green**        | Zero     | Medium     | Instant        | Production sites, frequent updates    |
| **Rolling Update**    | Zero     | Medium     | Gradual        | Containerized apps, high availability |
| **Canary**            | Zero     | High       | Controlled     | High-traffic sites, risk mitigation   |

### 1. Simple Deployment (Traditional)

```bash
#!/bin/bash
# scripts/deploy-simple.sh

set -e

echo "üöÄ Starting deployment..."

# Enable maintenance mode
php artisan down --message="Updating system, will be back shortly"

# Pull latest code
git pull origin main

# Install dependencies
composer install --no-dev --optimize-autoloader
npm install
npm run build

# Run migrations
php artisan migrate --force

# Clear and rebuild cache
php artisan optimize:clear
php artisan optimize

# Restart queue workers
php artisan queue:restart

# Disable maintenance mode
php artisan up

echo "‚úÖ Deployment completed!"
```

### 2. Blue-Green Deployment (Docker)

```bash
#!/bin/bash
# scripts/deploy-blue-green.sh

set -e

CURRENT=$(docker ps --filter "name=creativetrees-web" --format "{{.Names}}" | head -1)

if [[ $CURRENT == *"blue"* ]]; then
    NEW_ENV="green"
    OLD_ENV="blue"
else
    NEW_ENV="blue"
    OLD_ENV="green"
fi

echo "üîµ Current: $OLD_ENV, Deploying: $NEW_ENV"

# Build new environment
docker compose -f docker-compose.${NEW_ENV}.yml build
docker compose -f docker-compose.${NEW_ENV}.yml up -d

# Wait for health check
echo "‚è≥ Waiting for $NEW_ENV to be ready..."
sleep 30

# Test new environment
if curl -f http://localhost:8081/up; then
    echo "‚úÖ $NEW_ENV is healthy"

    # Switch traffic (update load balancer/nginx config)
    # Update upstream server

    # Stop old environment
    docker compose -f docker-compose.${OLD_ENV}.yml down

    echo "‚úÖ Deployment complete! Traffic switched to $NEW_ENV"
else
    echo "‚ùå $NEW_ENV health check failed! Rolling back..."
    docker compose -f docker-compose.${NEW_ENV}.yml down
    exit 1
fi
```

### 3. Rolling Update (Kubernetes-style)

```bash
#!/bin/bash
# scripts/deploy-rolling.sh

set -e

# Build new image
docker compose build app

# Update containers one by one
for container in app-1 app-2 app-3; do
    echo "üì¶ Updating $container..."

    # Stop container
    docker stop $container

    # Remove old container
    docker rm $container

    # Start new container
    docker compose up -d $container

    # Wait for health check
    sleep 15

    echo "‚úÖ $container updated"
done

echo "‚úÖ Rolling update complete!"
```

### 4. Zero-Downtime Deployment with Health Checks

```bash
#!/bin/bash
# scripts/deploy-zero-downtime.sh

set -e

PROJECT_DIR="/var/www/creativetrees"
HEALTH_ENDPOINT="http://localhost:8080/up"

cd $PROJECT_DIR

echo "üöÄ Zero-downtime deployment starting..."

# Pull latest code
git pull origin main

# Install dependencies in background
composer install --no-dev --optimize-autoloader &
COMPOSER_PID=$!

npm install &
NPM_PID=$!

# Wait for installations
wait $COMPOSER_PID
wait $NPM_PID

# Build assets
npm run build

# Run migrations (safe, non-destructive only)
php artisan migrate --force

# Clear old cache
php artisan config:clear
php artisan route:clear
php artisan view:clear

# Rebuild cache
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Reload PHP-FPM gracefully (zero downtime)
sudo systemctl reload php8.4-fpm

# Restart queue workers
php artisan queue:restart

# Verify health
if curl -f $HEALTH_ENDPOINT; then
    echo "‚úÖ Deployment successful! Application is healthy."
else
    echo "‚ùå Health check failed! Manual intervention required."
    exit 1
fi

echo "‚úÖ Zero-downtime deployment complete!"
```

### CI/CD Pipeline (GitHub Actions)

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
    push:
        branches: [main]

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: "8.4"

            - name: Install dependencies
              run: composer install --no-dev --optimize-autoloader

            - name: Run tests
              run: php artisan test

            - name: Build assets
              run: |
                  npm install
                  npm run build

            - name: Deploy via SSH
              uses: appleboy/ssh-action@master
              with:
                  host: ${{ secrets.SSH_HOST }}
                  username: ${{ secrets.SSH_USER }}
                  key: ${{ secrets.SSH_PRIVATE_KEY }}
                  script: |
                      cd /var/www/creativetrees
                      git pull origin main
                      docker compose build
                      docker compose up -d
                      docker compose exec -T app php artisan migrate --force
                      docker compose exec -T app php artisan optimize

            - name: Notify Slack
              uses: 8398a7/action-slack@v3
              with:
                  status: ${{ job.status }}
                  webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

### Deployment Checklist

**Pre-Deployment:**

- [ ] All tests passing
- [ ] Code reviewed and approved
- [ ] Database backup created
- [ ] `.env` file updated (if needed)
- [ ] Migration scripts reviewed
- [ ] Rollback plan documented
- [ ] Stakeholders notified

**Deployment:**

- [ ] Enable maintenance mode (if needed)
- [ ] Pull latest code
- [ ] Install dependencies
- [ ] Run migrations
- [ ] Clear caches
- [ ] Build assets
- [ ] Restart services
- [ ] Verify health checks

**Post-Deployment:**

- [ ] Application accessible
- [ ] Key features tested
- [ ] Error logs checked
- [ ] Performance metrics normal
- [ ] Rollback prepared (if issues found)
- [ ] Documentation updated
- [ ] Team notified of completion

---

<details>
<summary><strong>Container won't start</strong></summary>

```bash
# Check logs
docker compose logs app

# Rebuild containers
docker compose down -v
docker compose build --no-cache
docker compose up -d
```

</details>

<details>
<summary><strong>Permission denied errors</strong></summary>

```bash
# Fix storage permissions
docker compose exec app chown -R www-data:www-data storage bootstrap/cache
docker compose exec app chmod -R 775 storage bootstrap/cache
```

</details>

<details>
<summary><strong>Database connection failed</strong></summary>

```bash
# Wait for MySQL to be ready
docker compose exec app php artisan migrate --force

# Check MySQL status
docker compose exec mysql mysql -u root -p -e "SHOW DATABASES;"
```

</details>

<details>
<summary><strong>Assets not loading</strong></summary>

```bash
# Rebuild assets
docker compose exec node npm run build

# Clear view cache
docker compose exec app php artisan view:clear
```

</details>

---

## ‚ùì FAQ

<details>
<summary><strong>How do I create an admin user?</strong></summary>

```bash
docker compose exec app php artisan make:filament-user
```

Follow the prompts to enter name, email, and password.

</details>

<details>
<summary><strong>How do I reset a user's password?</strong></summary>

```bash
docker compose exec app php artisan tinker
>>> User::where('email', 'user@example.com')->update(['password' => bcrypt('newpassword')]);
```

</details>

<details>
<summary><strong>How do I enable maintenance mode?</strong></summary>

```bash
# Enable with bypass token
docker compose exec app php artisan down --secret="bypass-token"

# Disable
docker compose exec app php artisan up
```

</details>

<details>
<summary><strong>Where are the logs?</strong></summary>

```bash
# Laravel logs
docker compose exec app tail -f storage/logs/laravel.log

# Container logs
docker compose logs -f app
```

</details>

---

## ÔøΩ Monitoring & Alerting

### Monitoring Stack Architecture

```mermaid
graph TB
    subgraph "Application Layer"
        App[Laravel Application]
        Queue[Queue Workers]
        Scheduler[Task Scheduler]
    end

    subgraph "Metrics Collection"
        PE[Prometheus Exporters]
        CA[cAdvisor<br/>Container Metrics]
        NE[Node Exporter<br/>System Metrics]
        RE[Redis Exporter]
        ME[MySQL Exporter]
    end

    subgraph "Monitoring Platform"
        P[Prometheus<br/>:9090]
        G[Grafana<br/>:3000]
        AM[Alertmanager<br/>:9093]
    end

    subgraph "Notification Channels"
        Email[Email Alerts]
        Slack[Slack Webhook]
        PD[PagerDuty]
        Teams[MS Teams]
    end

    App --> PE
    Queue --> PE
    Scheduler --> PE

    PE --> P
    CA --> P
    NE --> P
    RE --> P
    ME --> P

    P --> G
    P --> AM

    AM --> Email
    AM --> Slack
    AM --> PD
    AM --> Teams

    style P fill:#e24d42
    style G fill:#f46800
    style AM fill:#e24d42
```

### Grafana Dashboards

Access Grafana at **http://localhost:3000** (admin/admin)

| Dashboard               | Purpose                 | Key Metrics                                                |
| ----------------------- | ----------------------- | ---------------------------------------------------------- |
| **Laravel Application** | Application performance | Request rate, Response time, Error rate, Queue depth       |
| **Docker Container**    | Container health        | CPU usage, Memory usage, Network I/O, Disk I/O             |
| **MySQL Database**      | Database performance    | Queries/sec, Slow queries, Connections, InnoDB buffer pool |
| **Redis Cache**         | Cache efficiency        | Hit rate, Memory usage, Connected clients, Commands/sec    |
| **Nginx Web Server**    | HTTP traffic            | Requests/sec, Response codes, Bandwidth, Connection states |
| **System Resources**    | Server health           | CPU load, Memory usage, Disk usage, Network traffic        |

### Prometheus Alerting Rules

Create `docker/monitoring/prometheus/alerts.yml`:

```yaml
groups:
    - name: application_alerts
      interval: 30s
      rules:
          # High Error Rate
          - alert: HighErrorRate
            expr: rate(laravel_errors_total[5m]) > 10
            for: 5m
            labels:
                severity: critical
                component: application
            annotations:
                summary: "High error rate detected"
                description: "{{ $labels.instance }} has error rate {{ $value }} errors/sec"

          # Queue Backlog
          - alert: QueueBacklog
            expr: laravel_queue_size > 1000
            for: 10m
            labels:
                severity: warning
                component: queue
            annotations:
                summary: "Queue backlog detected"
                description: "{{ $labels.queue }} has {{ $value }} pending jobs"

          # Slow Response Time
          - alert: SlowResponseTime
            expr: histogram_quantile(0.95, rate(laravel_request_duration_seconds_bucket[5m])) > 2
            for: 5m
            labels:
                severity: warning
                component: application
            annotations:
                summary: "Slow response time"
                description: "95th percentile response time is {{ $value }}s"

    - name: infrastructure_alerts
      interval: 30s
      rules:
          # Container Down
          - alert: ContainerDown
            expr: up{job="docker"} == 0
            for: 2m
            labels:
                severity: critical
                component: infrastructure
            annotations:
                summary: "Container is down"
                description: "{{ $labels.instance }} has been down for more than 2 minutes"

          # High CPU Usage
          - alert: HighCPUUsage
            expr: container_cpu_usage_seconds_total > 80
            for: 5m
            labels:
                severity: warning
                component: infrastructure
            annotations:
                summary: "High CPU usage"
                description: "{{ $labels.container_name }} CPU usage is {{ $value }}%"

          # High Memory Usage
          - alert: HighMemoryUsage
            expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 85
            for: 5m
            labels:
                severity: warning
                component: infrastructure
            annotations:
                summary: "High memory usage"
                description: "{{ $labels.container_name }} memory usage is {{ $value }}%"

          # Disk Space Low
          - alert: DiskSpaceLow
            expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 15
            for: 5m
            labels:
                severity: warning
                component: infrastructure
            annotations:
                summary: "Low disk space"
                description: "{{ $labels.instance }} has {{ $value }}% disk space remaining"

    - name: database_alerts
      interval: 30s
      rules:
          # MySQL Connection Pool Exhausted
          - alert: MySQLConnectionPoolExhausted
            expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections > 0.8
            for: 5m
            labels:
                severity: critical
                component: database
            annotations:
                summary: "MySQL connection pool near exhaustion"
                description: "{{ $value }}% of connections in use"

          # MySQL Slow Queries
          - alert: MySQLSlowQueries
            expr: rate(mysql_global_status_slow_queries[5m]) > 5
            for: 5m
            labels:
                severity: warning
                component: database
            annotations:
                summary: "High slow query rate"
                description: "{{ $value }} slow queries per second"

          # Redis Memory Usage High
          - alert: RedisMemoryHigh
            expr: (redis_memory_used_bytes / redis_memory_max_bytes) * 100 > 80
            for: 5m
            labels:
                severity: warning
                component: cache
            annotations:
                summary: "Redis memory usage high"
                description: "Redis using {{ $value }}% of allocated memory"
```

### Alert Notification Configuration

Configure Alertmanager (`docker/monitoring/alertmanager/config.yml`):

```yaml
global:
    resolve_timeout: 5m
    smtp_smarthost: "mailpit:1025"
    smtp_from: "alertmanager@creativetrees.local"
    smtp_require_tls: false

route:
    group_by: ["alertname", "cluster", "service"]
    group_wait: 10s
    group_interval: 10s
    repeat_interval: 12h
    receiver: "default"
    routes:
        - match:
              severity: critical
          receiver: "critical-alerts"
          continue: true
        - match:
              severity: warning
          receiver: "warning-alerts"

receivers:
    - name: "default"
      email_configs:
          - to: "ops-team@example.com"
            headers:
                Subject: "[ALERT] {{ .GroupLabels.alertname }}"

    - name: "critical-alerts"
      email_configs:
          - to: "oncall@example.com"
            headers:
                Subject: "[CRITICAL] {{ .GroupLabels.alertname }}"
      slack_configs:
          - api_url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
            channel: "#alerts-critical"
            title: "Critical Alert: {{ .GroupLabels.alertname }}"
            text: "{{ range .Alerts }}{{ .Annotations.description }}{{ end }}"
      pagerduty_configs:
          - service_key: "YOUR_PAGERDUTY_SERVICE_KEY"
            description: "{{ .GroupLabels.alertname }}"

    - name: "warning-alerts"
      slack_configs:
          - api_url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
            channel: "#alerts-warnings"
            title: "Warning: {{ .GroupLabels.alertname }}"
            text: "{{ range .Alerts }}{{ .Annotations.description }}{{ end }}"

inhibit_rules:
    - source_match:
          severity: "critical"
      target_match:
          severity: "warning"
      equal: ["alertname", "instance"]
```

### Application Performance Monitoring (APM)

**Laravel Telescope** (Development):

```bash
# Install Telescope
docker compose exec app composer require laravel/telescope --dev
docker compose exec app php artisan telescope:install
docker compose exec app php artisan migrate

# Access at: http://localhost/telescope
```

**Custom Health Check Endpoint**:

```php
// routes/web.php
Route::get('/health', function () {
    $checks = [
        'database' => DB::connection()->getPdo() !== null,
        'redis' => Redis::connection()->ping(),
        'cache' => Cache::has('health_check') || Cache::put('health_check', true, 60),
        'queue' => Queue::size() >= 0,
    ];

    $status = array_reduce($checks, fn($carry, $check) => $carry && $check, true);

    return response()->json([
        'status' => $status ? 'healthy' : 'unhealthy',
        'checks' => $checks,
        'timestamp' => now()->toIso8601String(),
    ], $status ? 200 : 503);
});
```

**Monitor Application Metrics**:

```bash
# Check health endpoint
curl http://localhost/health

# Monitor queue depth
docker compose exec app php artisan queue:monitor redis:default,redis:notifications --max=100

# Monitor failed jobs
docker compose exec app php artisan queue:failed

# Monitor horizon (if using Laravel Horizon)
docker compose exec app php artisan horizon:status
```

### Log Aggregation

**Centralized Logging with Syslog**:

```yaml
# Add to docker-compose.yml services
fluentd:
    image: fluent/fluentd:v1.16-1
    volumes:
        - ./docker/fluentd/fluent.conf:/fluentd/etc/fluent.conf
        - ./storage/logs:/var/log/laravel
    ports:
        - "24224:24224"
    networks:
        - creativetrees

elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.3
    environment:
        - discovery.type=single-node
        - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
        - elasticsearch-data:/usr/share/elasticsearch/data
    networks:
        - creativetrees

kibana:
    image: docker.elastic.co/kibana/kibana:8.11.3
    ports:
        - "5601:5601"
    environment:
        ELASTICSEARCH_HOSTS: http://elasticsearch:9200
    depends_on:
        - elasticsearch
    networks:
        - creativetrees
```

**Laravel Logging Configuration**:

```php
// config/logging.php
'channels' => [
    'stack' => [
        'driver' => 'stack',
        'channels' => ['daily', 'syslog', 'slack'],
        'ignore_exceptions' => false,
    ],

    'syslog' => [
        'driver' => 'syslog',
        'level' => env('LOG_LEVEL', 'debug'),
        'facility' => LOG_USER,
    ],

    'slack' => [
        'driver' => 'slack',
        'url' => env('LOG_SLACK_WEBHOOK_URL'),
        'username' => 'Laravel Log',
        'emoji' => ':boom:',
        'level' => 'critical',
    ],
],
```

---

## üíæ Backup & Disaster Recovery

### Backup Strategy (3-2-1 Rule)

```mermaid
graph LR
    subgraph "Primary Data"
        DB[(MySQL Database)]
        Files[Application Files]
        Config[Configuration]
        Redis[(Redis Data)]
    end

    subgraph "Backup Copy 1 - Local"
        L1[Daily Backups<br/>Last 7 Days]
        L2[Weekly Backups<br/>Last 4 Weeks]
    end

    subgraph "Backup Copy 2 - Network Storage"
        NAS[NAS/Network Drive<br/>Monthly Archives]
    end

    subgraph "Backup Copy 3 - Offsite/Cloud"
        S3[AWS S3<br/>Glacier Deep Archive]
        GD[Google Drive<br/>Long-term Storage]
    end

    DB --> L1
    Files --> L1
    Config --> L1
    Redis --> L1

    L1 --> L2
    L2 --> NAS

    L1 --> S3
    L2 --> GD

    style S3 fill:#FF9900
    style GD fill:#4285F4
    style L1 fill:#28a745
```

### Automated Backup Script

Create `scripts/backup.sh`:

```bash
#!/bin/bash

###############################################################################
# Creativetree Production - Comprehensive Backup Script
# Implements 3-2-1 Backup Strategy (3 copies, 2 media types, 1 offsite)
###############################################################################

set -euo pipefail

# Configuration
BACKUP_ROOT="/var/backups/creativetrees"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="${BACKUP_ROOT}/${TIMESTAMP}"
RETENTION_DAYS=7
RETENTION_WEEKS=4
RETENTION_MONTHS=12

# Database credentials
DB_HOST="localhost"
DB_NAME="${DB_DATABASE:-creativetrees}"
DB_USER="${DB_USERNAME:-root}"
DB_PASS="${DB_PASSWORD}"

# S3 Configuration (optional)
S3_BUCKET="${BACKUP_S3_BUCKET:-}"
S3_ENABLED="${BACKUP_S3_ENABLED:-false}"

# Google Drive Configuration (optional)
GDRIVE_FOLDER_ID="${BACKUP_GDRIVE_FOLDER_ID:-}"
GDRIVE_ENABLED="${BACKUP_GDRIVE_ENABLED:-false}"

# Notification
SLACK_WEBHOOK="${BACKUP_SLACK_WEBHOOK:-}"
EMAIL_TO="${BACKUP_EMAIL_TO:-ops@example.com}"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

###############################################################################
# Functions
###############################################################################

log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
    notify_failure "$1"
    exit 1
}

notify_success() {
    local message="‚úÖ Backup Successful: $1"

    # Slack notification
    if [[ -n "$SLACK_WEBHOOK" ]]; then
        curl -X POST "$SLACK_WEBHOOK" \
            -H 'Content-Type: application/json' \
            -d "{\"text\":\"$message\"}" > /dev/null 2>&1 || true
    fi

    # Email notification
    if command -v mail &> /dev/null; then
        echo "$message" | mail -s "Backup Success - Creativetrees" "$EMAIL_TO" || true
    fi
}

notify_failure() {
    local message="‚ùå Backup Failed: $1"

    # Slack notification
    if [[ -n "$SLACK_WEBHOOK" ]]; then
        curl -X POST "$SLACK_WEBHOOK" \
            -H 'Content-Type: application/json' \
            -d "{\"text\":\"$message\",\"color\":\"danger\"}" > /dev/null 2>&1 || true
    fi

    # Email notification
    if command -v mail &> /dev/null; then
        echo "$message" | mail -s "Backup FAILURE - Creativetrees" "$EMAIL_TO" || true
    fi
}

###############################################################################
# Backup Functions
###############################################################################

backup_database() {
    log "Backing up MySQL database..."

    mkdir -p "${BACKUP_DIR}/database"

    # Full database dump
    docker compose exec -T mysql mysqldump \
        --user="$DB_USER" \
        --password="$DB_PASS" \
        --single-transaction \
        --quick \
        --lock-tables=false \
        --routines \
        --triggers \
        --events \
        "$DB_NAME" | gzip > "${BACKUP_DIR}/database/${DB_NAME}_full_${TIMESTAMP}.sql.gz"

    # Individual table dumps (for faster selective restore)
    local tables=$(docker compose exec -T mysql mysql \
        --user="$DB_USER" \
        --password="$DB_PASS" \
        -Nse "SHOW TABLES FROM ${DB_NAME}")

    for table in $tables; do
        docker compose exec -T mysql mysqldump \
            --user="$DB_USER" \
            --password="$DB_PASS" \
            --single-transaction \
            "$DB_NAME" "$table" | gzip > "${BACKUP_DIR}/database/${DB_NAME}_${table}_${TIMESTAMP}.sql.gz"
    done

    log "Database backup completed: $(du -sh ${BACKUP_DIR}/database | cut -f1)"
}

backup_files() {
    log "Backing up application files..."

    mkdir -p "${BACKUP_DIR}/files"

    # Storage directory (user uploads, logs, etc.)
    tar -czf "${BACKUP_DIR}/files/storage_${TIMESTAMP}.tar.gz" \
        -C /var/www/html \
        storage/ \
        --exclude='storage/framework/cache' \
        --exclude='storage/framework/sessions' \
        --exclude='storage/framework/views' \
        --exclude='storage/logs/*.log'

    # Public uploads
    if [ -d "/var/www/html/public/uploads" ]; then
        tar -czf "${BACKUP_DIR}/files/uploads_${TIMESTAMP}.tar.gz" \
            -C /var/www/html/public \
            uploads/
    fi

    # Media library (if using Spatie Media Library)
    if [ -d "/var/www/html/storage/app/public/media" ]; then
        tar -czf "${BACKUP_DIR}/files/media_${TIMESTAMP}.tar.gz" \
            -C /var/www/html/storage/app/public \
            media/
    fi

    log "Files backup completed: $(du -sh ${BACKUP_DIR}/files | cut -f1)"
}

backup_config() {
    log "Backing up configuration files..."

    mkdir -p "${BACKUP_DIR}/config"

    # Environment file
    cp /var/www/html/.env "${BACKUP_DIR}/config/.env_${TIMESTAMP}"

    # Configuration directory
    tar -czf "${BACKUP_DIR}/config/config_${TIMESTAMP}.tar.gz" \
        -C /var/www/html \
        config/

    # Docker configuration
    tar -czf "${BACKUP_DIR}/config/docker_${TIMESTAMP}.tar.gz" \
        -C /var/www/html \
        docker-compose.yml \
        docker-compose.prod.yml \
        docker/ \
        --exclude='docker/*/logs'

    # Nginx configuration
    if [ -d "/var/www/html/docker/nginx" ]; then
        tar -czf "${BACKUP_DIR}/config/nginx_${TIMESTAMP}.tar.gz" \
            -C /var/www/html/docker \
            nginx/
    fi

    log "Config backup completed: $(du -sh ${BACKUP_DIR}/config | cut -f1)"
}

backup_redis() {
    log "Backing up Redis data..."

    mkdir -p "${BACKUP_DIR}/redis"

    # Trigger Redis save
    docker compose exec -T redis redis-cli BGSAVE
    sleep 2

    # Copy RDB file
    docker compose cp redis:/data/dump.rdb "${BACKUP_DIR}/redis/dump_${TIMESTAMP}.rdb"
    gzip "${BACKUP_DIR}/redis/dump_${TIMESTAMP}.rdb"

    log "Redis backup completed: $(du -sh ${BACKUP_DIR}/redis | cut -f1)"
}

create_manifest() {
    log "Creating backup manifest..."

    cat > "${BACKUP_DIR}/MANIFEST.txt" <<EOF
Creativetrees Production Backup
================================

Backup Date: $(date)
Backup ID: ${TIMESTAMP}
Hostname: $(hostname)
Server IP: $(hostname -I | awk '{print $1}')

Contents:
---------
EOF

    find "${BACKUP_DIR}" -type f -exec ls -lh {} \; | awk '{print $9, "("$5")"}' >> "${BACKUP_DIR}/MANIFEST.txt"

    # Calculate checksums
    log "Calculating checksums..."
    find "${BACKUP_DIR}" -type f -not -name "MANIFEST.txt" -not -name "checksums.sha256" -exec sha256sum {} \; > "${BACKUP_DIR}/checksums.sha256"
}

compress_backup() {
    log "Compressing backup archive..."

    cd "${BACKUP_ROOT}"
    tar -czf "backup_${TIMESTAMP}.tar.gz" "${TIMESTAMP}/"

    # Encrypt backup (optional)
    if [[ -n "${BACKUP_ENCRYPTION_PASSWORD:-}" ]]; then
        log "Encrypting backup..."
        openssl enc -aes-256-cbc -salt -pbkdf2 \
            -in "backup_${TIMESTAMP}.tar.gz" \
            -out "backup_${TIMESTAMP}.tar.gz.enc" \
            -pass "pass:${BACKUP_ENCRYPTION_PASSWORD}"
        rm "backup_${TIMESTAMP}.tar.gz"
    fi

    log "Compressed backup: $(du -sh backup_${TIMESTAMP}.tar.gz* | cut -f1)"
}

sync_to_s3() {
    if [[ "$S3_ENABLED" != "true" ]] || [[ -z "$S3_BUCKET" ]]; then
        warn "S3 sync disabled or not configured"
        return 0
    fi

    log "Syncing to AWS S3..."

    aws s3 cp "${BACKUP_ROOT}/backup_${TIMESTAMP}.tar.gz"* \
        "s3://${S3_BUCKET}/backups/daily/${TIMESTAMP}/" \
        --storage-class STANDARD_IA

    # Move to Glacier after 30 days (lifecycle policy)
    log "S3 sync completed"
}

sync_to_gdrive() {
    if [[ "$GDRIVE_ENABLED" != "true" ]] || [[ -z "$GDRIVE_FOLDER_ID" ]]; then
        warn "Google Drive sync disabled or not configured"
        return 0
    fi

    log "Syncing to Google Drive..."

    # Using rclone (install: curl https://rclone.org/install.sh | sudo bash)
    if command -v rclone &> /dev/null; then
        rclone copy "${BACKUP_ROOT}/backup_${TIMESTAMP}.tar.gz"* \
            "gdrive:${GDRIVE_FOLDER_ID}" \
            --progress
        log "Google Drive sync completed"
    else
        warn "rclone not installed, skipping Google Drive sync"
    fi
}

cleanup_old_backups() {
    log "Cleaning up old backups..."

    # Daily backups: Keep last 7 days
    find "${BACKUP_ROOT}" -maxdepth 1 -type d -name "20*" -mtime +${RETENTION_DAYS} -exec rm -rf {} \;
    find "${BACKUP_ROOT}" -maxdepth 1 -type f -name "backup_*.tar.gz*" -mtime +${RETENTION_DAYS} -delete

    # Weekly backups: Keep last 4 weeks (move to weekly folder on Sundays)
    if [[ $(date +%u) -eq 7 ]]; then
        mkdir -p "${BACKUP_ROOT}/weekly"
        cp "${BACKUP_ROOT}/backup_${TIMESTAMP}.tar.gz"* "${BACKUP_ROOT}/weekly/"
        find "${BACKUP_ROOT}/weekly" -type f -mtime +$((RETENTION_WEEKS * 7)) -delete
    fi

    # Monthly backups: Keep last 12 months (move to monthly folder on 1st)
    if [[ $(date +%d) -eq 01 ]]; then
        mkdir -p "${BACKUP_ROOT}/monthly"
        cp "${BACKUP_ROOT}/backup_${TIMESTAMP}.tar.gz"* "${BACKUP_ROOT}/monthly/"
        find "${BACKUP_ROOT}/monthly" -type f -mtime +$((RETENTION_MONTHS * 30)) -delete
    fi

    log "Cleanup completed"
}

###############################################################################
# Main Execution
###############################################################################

main() {
    log "Starting Creativetrees backup process..."

    # Create backup directory
    mkdir -p "$BACKUP_DIR"

    # Execute backups
    backup_database
    backup_files
    backup_config
    backup_redis

    # Create manifest and checksums
    create_manifest

    # Compress
    compress_backup

    # Sync to remote storage
    sync_to_s3
    sync_to_gdrive

    # Cleanup
    cleanup_old_backups

    # Calculate total size
    TOTAL_SIZE=$(du -sh "${BACKUP_ROOT}/backup_${TIMESTAMP}.tar.gz"* | cut -f1)

    log "Backup completed successfully!"
    log "Backup location: ${BACKUP_ROOT}/backup_${TIMESTAMP}.tar.gz*"
    log "Total size: ${TOTAL_SIZE}"

    notify_success "Backup completed - Size: ${TOTAL_SIZE}"
}

# Run main function
main "$@"
```

**Make script executable and schedule**:

```bash
# Make executable
chmod +x scripts/backup.sh

# Add to crontab for daily backups at 2 AM
crontab -e
0 2 * * * /var/www/html/scripts/backup.sh >> /var/log/creativetrees-backup.log 2>&1
```

### Database Recovery Procedures

**Restore from Full Backup**:

```bash
# Extract backup
cd /var/backups/creativetrees
tar -xzf backup_20240115_020000.tar.gz

# Restore database
gunzip 20240115_020000/database/creativetrees_full_20240115_020000.sql.gz

docker compose exec -T mysql mysql \
    --user=root \
    --password="$DB_PASSWORD" \
    creativetrees < 20240115_020000/database/creativetrees_full_20240115_020000.sql

# Verify restoration
docker compose exec mysql mysql -u root -p"$DB_PASSWORD" -e "SELECT COUNT(*) FROM users" creativetrees
```

**Restore Individual Table**:

```bash
# Extract specific table backup
gunzip 20240115_020000/database/creativetrees_users_20240115_020000.sql.gz

# Drop and restore table
docker compose exec -T mysql mysql \
    --user=root \
    --password="$DB_PASSWORD" \
    creativetrees < 20240115_020000/database/creativetrees_users_20240115_020000.sql
```

**Point-in-Time Recovery** (requires binary logs):

```bash
# Enable binary logging in docker-compose.yml
# mysql:
#   command: --log-bin=mysql-bin --binlog-format=ROW

# Find binary log position
docker compose exec mysql mysqlbinlog /var/lib/mysql/mysql-bin.000001 | grep -A 5 "2024-01-15 10:30:00"

# Restore to specific point
docker compose exec mysql mysqlbinlog \
    --start-datetime="2024-01-15 00:00:00" \
    --stop-datetime="2024-01-15 10:30:00" \
    /var/lib/mysql/mysql-bin.000001 | \
    docker compose exec -T mysql mysql -u root -p"$DB_PASSWORD" creativetrees
```

### Full System Recovery

Create `scripts/restore.sh`:

```bash
#!/bin/bash

###############################################################################
# Creativetrees - Full System Restore Script
###############################################################################

set -euo pipefail

BACKUP_FILE="$1"
RESTORE_ROOT="/var/www/html"

if [[ ! -f "$BACKUP_FILE" ]]; then
    echo "Error: Backup file not found: $BACKUP_FILE"
    exit 1
fi

echo "=== Creativetrees Full System Restore ==="
echo "Backup: $BACKUP_FILE"
echo "Target: $RESTORE_ROOT"
echo ""
read -p "This will OVERWRITE existing data. Continue? (yes/no): " confirm

if [[ "$confirm" != "yes" ]]; then
    echo "Restore cancelled"
    exit 0
fi

# Stop services
echo "Stopping services..."
cd "$RESTORE_ROOT"
docker compose down

# Extract backup
echo "Extracting backup..."
TEMP_DIR=$(mktemp -d)
tar -xzf "$BACKUP_FILE" -C "$TEMP_DIR"
BACKUP_DIR=$(find "$TEMP_DIR" -maxdepth 1 -type d -name "20*" | head -1)

# Verify checksums
echo "Verifying backup integrity..."
cd "$BACKUP_DIR"
sha256sum -c checksums.sha256 || {
    echo "Checksum verification failed!"
    exit 1
}

# Restore files
echo "Restoring application files..."
tar -xzf "${BACKUP_DIR}/files/storage_"*.tar.gz -C "$RESTORE_ROOT"
[ -f "${BACKUP_DIR}/files/uploads_"*.tar.gz ] && tar -xzf "${BACKUP_DIR}/files/uploads_"*.tar.gz -C "${RESTORE_ROOT}/public"
[ -f "${BACKUP_DIR}/files/media_"*.tar.gz ] && tar -xzf "${BACKUP_DIR}/files/media_"*.tar.gz -C "${RESTORE_ROOT}/storage/app/public"

# Restore configuration
echo "Restoring configuration..."
cp "${BACKUP_DIR}/config/.env_"* "${RESTORE_ROOT}/.env"
tar -xzf "${BACKUP_DIR}/config/docker_"*.tar.gz -C "$RESTORE_ROOT"

# Start database
echo "Starting database..."
cd "$RESTORE_ROOT"
docker compose up -d mysql
sleep 10

# Restore database
echo "Restoring database..."
gunzip -c "${BACKUP_DIR}/database/"*_full_*.sql.gz | \
    docker compose exec -T mysql mysql -u root -p"$DB_PASSWORD" creativetrees

# Restore Redis
echo "Restoring Redis..."
docker compose up -d redis
gunzip -c "${BACKUP_DIR}/redis/dump_"*.rdb.gz > /tmp/dump.rdb
docker compose cp /tmp/dump.rdb redis:/data/dump.rdb
docker compose restart redis

# Start all services
echo "Starting all services..."
docker compose up -d

# Wait for services
sleep 15

# Run post-restore tasks
echo "Running post-restore tasks..."
docker compose exec app php artisan migrate --force
docker compose exec app php artisan cache:clear
docker compose exec app php artisan config:cache
docker compose exec app php artisan route:cache
docker compose exec app php artisan view:cache
docker compose exec app php artisan queue:restart

# Set permissions
echo "Setting permissions..."
docker compose exec app chown -R www-data:www-data storage bootstrap/cache
docker compose exec app chmod -R 775 storage bootstrap/cache

# Cleanup
rm -rf "$TEMP_DIR"

echo ""
echo "=== Restore Completed Successfully ==="
echo "Please verify your application at: http://localhost"
```

### Disaster Recovery Plan

| **Scenario**                   | **RTO** | **RPO** | **Recovery Steps**                                                                       |
| ------------------------------ | ------- | ------- | ---------------------------------------------------------------------------------------- |
| **Database Corruption**        | 15 min  | 1 day   | 1. Restore from last backup<br/>2. Apply binary logs<br/>3. Verify data integrity        |
| **Application Server Failure** | 30 min  | 1 day   | 1. Provision new server<br/>2. Restore from backup<br/>3. Update DNS                     |
| **Complete Data Center Loss**  | 4 hours | 1 day   | 1. Activate DR site<br/>2. Restore from S3/GDrive<br/>3. Update DNS to DR                |
| **Ransomware Attack**          | 2 hours | 1 day   | 1. Isolate affected systems<br/>2. Restore from immutable backup<br/>3. Scan for malware |
| **Accidental Data Deletion**   | 5 min   | 1 hour  | 1. Restore specific table<br/>2. Verify restored data<br/>3. Update application          |

### DR Testing Schedule

```bash
# Quarterly DR Test Script
#!/bin/bash

echo "=== Disaster Recovery Test - $(date) ==="

# 1. Verify backups exist
echo "1. Checking backup availability..."
LATEST_BACKUP=$(ls -t /var/backups/creativetrees/backup_*.tar.gz | head -1)
echo "Latest backup: $LATEST_BACKUP"

# 2. Test backup integrity
echo "2. Testing backup integrity..."
tar -tzf "$LATEST_BACKUP" > /dev/null && echo "‚úì Backup integrity OK"

# 3. Test database restore (on separate instance)
echo "3. Testing database restore..."
# [Restore to test database]

# 4. Test application startup
echo "4. Testing application startup..."
# [Start services on test environment]

# 5. Test critical functionality
echo "5. Testing critical functionality..."
# [Run smoke tests]

# 6. Measure RTO
echo "6. Recovery Time: $(date)"

# 7. Generate report
echo "DR Test completed - Report sent to ops@example.com"
```

---

## üìù Code Examples & Best Practices

### Laravel Best Practices

**1. Service Layer Pattern**:

```php
// app/Services/UserManagementService.php
namespace App\Services;

use App\Models\User;
use App\Events\UserCreated;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Hash;

class UserManagementService
{
    public function createUser(array $data): User
    {
        return DB::transaction(function () use ($data) {
            $user = User::create([
                'name' => $data['name'],
                'email' => $data['email'],
                'password' => Hash::make($data['password']),
                'role' => $data['role'] ?? UserRole::User,
                'status' => AccountStatus::Active,
            ]);

            // Create audit log
            AuditLog::create([
                'user_id' => auth()->id(),
                'event' => 'user.created',
                'auditable_type' => User::class,
                'auditable_id' => $user->id,
                'old_values' => null,
                'new_values' => $user->toArray(),
                'ip_address' => request()->ip(),
                'user_agent' => request()->userAgent(),
            ]);

            event(new UserCreated($user));

            return $user->fresh();
        });
    }
}
```

**2. Repository Pattern**:

```php
// app/Repositories/AuditLogRepository.php
namespace App\Repositories;

use App\Models\AuditLog;
use Illuminate\Contracts\Pagination\LengthAwarePaginator;

class AuditLogRepository
{
    public function __construct(private AuditLog $model) {}

    public function paginate(int $perPage = 15): LengthAwarePaginator
    {
        return $this->model
            ->with(['user', 'auditable'])
            ->latest()
            ->paginate($perPage);
    }

    public function verifyIntegrity(AuditLog $log): bool
    {
        $expectedHash = $log->calculateHash();
        return hash_equals($expectedHash, $log->hash);
    }
}
```

**3. Security Best Practices**:

```php
// ‚úÖ GOOD - Using Query Builder (Parameter Binding)
$users = DB::table('users')
    ->where('email', $request->input('email'))
    ->where('status', AccountStatus::Active)
    ->get();

// ‚ùå BAD - Raw SQL without bindings
$email = $request->input('email');
$users = DB::select("SELECT * FROM users WHERE email = '$email'");

// ‚úÖ GOOD - Mass Assignment Protection
class User extends Authenticatable
{
    protected $fillable = ['name', 'email', 'password', 'role'];
    protected $guarded = ['id', 'is_admin'];
    protected $hidden = ['password', 'remember_token'];
}
```

**4. Performance Optimization**:

```php
// ‚ùå BAD - N+1 Query Problem
$users = User::all();
foreach ($users as $user) {
    echo $user->loginActivities->count();
}

// ‚úÖ GOOD - Eager Loading
$users = User::withCount('loginActivities')->get();

// ‚úÖ GOOD - Caching
Cache::remember('users:active', 3600, fn () => User::active()->get());
```

### Filament Customization

**Custom Widget**:

```php
// app/Filament/Widgets/SystemHealthWidget.php
namespace App\Filament\Widgets;

use Filament\Widgets\StatsOverviewWidget as BaseWidget;
use Filament\Widgets\StatsOverviewWidget\Card;

class SystemHealthWidget extends BaseWidget
{
    protected function getCards(): array
    {
        return [
            Card::make('Database Status', $this->getDatabaseStatus())
                ->description('Latency: ' . $this->getDatabaseLatency() . 'ms')
                ->color($this->getDatabaseStatus() === 'Online' ? 'success' : 'danger'),

            Card::make('Queue Health', DB::table('jobs')->count() . ' jobs')
                ->description('Failed: ' . DB::table('failed_jobs')->count())
                ->color('success'),
        ];
    }
}
```

---

## üîÑ Migration & Upgrade Guide

### Version Upgrade Procedure

**Upgrading from v1.2.5 to v1.2.6**:

```bash
# 1. Backup current system
./scripts/backup.sh

# 2. Enable maintenance mode
docker compose exec app php artisan down --render="errors::503"

# 3. Pull latest code
git fetch origin
git checkout v1.2.6

# 4. Update dependencies
docker compose exec app composer install --no-dev --optimize-autoloader
docker compose exec node npm ci --production

# 5. Run migrations
docker compose exec app php artisan migrate --force

# 6. Clear and rebuild caches
docker compose exec app php artisan optimize
docker compose exec app php artisan config:cache
docker compose exec app php artisan route:cache
docker compose exec app php artisan view:cache

# 7. Restart queue workers
docker compose exec app php artisan queue:restart

# 8. Rebuild assets
docker compose exec node npm run build

# 9. Disable maintenance mode
docker compose exec app php artisan up

# 10. Verify deployment
curl http://localhost/health
```

### Breaking Changes

**v1.2.6**:

- PHP 8.4 required (upgrade from 8.3)
- Redis 7.0+ required for enhanced security features
- Environment variables added: `REDIS_PASSWORD`, `GRAFANA_ADMIN_PASSWORD`

**v1.2.0**:

- UserRole enum changed from string to backed enum
- AuditLog hash algorithm updated to SHA-256 (migration included)

### Database Migration Scripts

**Rollback Migration**:

```bash
# Rollback last migration
docker compose exec app php artisan migrate:rollback

# Rollback to specific batch
docker compose exec app php artisan migrate:rollback --batch=5

# Rollback all and re-run
docker compose exec app php artisan migrate:refresh
```

**Data Migration Example**:

```php
// database/migrations/xxxx_migrate_user_roles_to_enum.php
use Illuminate\Database\Migrations\Migration;
use App\Enums\UserRole;

return new class extends Migration
{
    public function up(): void
    {
        // Convert old string roles to new enum
        DB::table('users')->where('role', 'super_admin')->update(['role' => UserRole::SuperAdmin->value]);
        DB::table('users')->where('role', 'admin')->update(['role' => UserRole::Admin->value]);
        DB::table('users')->where('role', 'manager')->update(['role' => UserRole::Manager->value]);
        DB::table('users')->where('role', 'user')->update(['role' => UserRole::User->value]);
    }

    public function down(): void
    {
        // Revert to old format if needed
    }
};
```

---

## üë• Development Workflow

### Git Workflow

```bash
# 1. Create feature branch
git checkout -b feature/user-profile-enhancement

# 2. Make changes and commit
git add .
git commit -m "feat: Add avatar upload to user profile"

# 3. Push to remote
git push origin feature/user-profile-enhancement

# 4. Create Pull Request on GitHub
# 5. After review and approval, merge to main
```

### Code Review Checklist

- [ ] Code follows PSR-12 coding standards
- [ ] All tests pass (`php artisan test`)
- [ ] Code coverage maintained (>80%)
- [ ] Security vulnerabilities checked
- [ ] Performance impact assessed
- [ ] Documentation updated
- [ ] Migration files included (if database changes)
- [ ] Changelog updated

### Local Development Setup

```bash
# 1. Clone repository
git clone https://github.com/your-org/creativetrees.git
cd creativetrees

# 2. Copy environment file
cp .env.example .env

# 3. Update .env for local development
DB_DATABASE=creativetrees_local
APP_ENV=local
APP_DEBUG=true

# 4. Start Docker services
docker compose up -d

# 5. Install dependencies
docker compose exec app composer install
docker compose exec node npm install

# 6. Generate application key
docker compose exec app php artisan key:generate

# 7. Run migrations with seeders
docker compose exec app php artisan migrate:fresh --seed

# 8. Create admin user
docker compose exec app php artisan make:filament-user

# 9. Start development server
docker compose exec node npm run dev
```

---

## ü§ù Contributing

We welcome contributions! Please follow these guidelines:

### How to Contribute

1. **Fork the Repository**
2. **Create Feature Branch**: `git checkout -b feature/amazing-feature`
3. **Commit Changes**: `git commit -m 'feat: Add amazing feature'`
4. **Push to Branch**: `git push origin feature/amazing-feature`
5. **Open Pull Request**

### Commit Message Convention

Follow [Conventional Commits](https://www.conventionalcommits.org/):

```
feat: Add new feature
fix: Bug fix
docs: Documentation changes
style: Code style changes (formatting)
refactor: Code refactoring
perf: Performance improvements
test: Test additions/modifications
chore: Build process or auxiliary tool changes
```

### Code Style

- Follow **PSR-12** for PHP code
- Use **ESLint** for JavaScript
- Run `./vendor/bin/pint` before committing PHP code
- Run `npm run lint` for JavaScript code

### Testing Requirements

```bash
# Run all tests
docker compose exec app php artisan test

# Run with coverage
docker compose exec app php artisan test --coverage --min=80

# Run specific test suite
docker compose exec app php artisan test --testsuite=Feature

# Run Pest tests (if using Pest)
docker compose exec app ./vendor/bin/pest
```

### Pull Request Template

```markdown
## Description

Brief description of changes

## Type of Change

- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update

## Testing

- [ ] Unit tests added/updated
- [ ] Feature tests added/updated
- [ ] Manual testing completed

## Checklist

- [ ] Code follows style guidelines
- [ ] Self-review completed
- [ ] Comments added for complex code
- [ ] Documentation updated
- [ ] No new warnings generated
- [ ] Tests pass locally
```

---

## üîß Troubleshooting

### Common Issues

**1. Permission Denied Errors**:

```bash
# Fix storage permissions
docker compose exec app chown -R www-data:www-data storage bootstrap/cache
docker compose exec app chmod -R 775 storage bootstrap/cache
```

**2. Database Connection Failed**:

```bash
# Check MySQL container status
docker compose ps mysql

# Check MySQL logs
docker compose logs mysql

# Test connection
docker compose exec app php artisan tinker
>>> DB::connection()->getPdo();
```

**3. Redis Connection Error**:

```bash
# Verify Redis is running
docker compose ps redis

# Test Redis connection
docker compose exec redis redis-cli ping

# Check Redis authentication
docker compose exec redis redis-cli -a "$REDIS_PASSWORD" ping
```

**4. Queue Not Processing**:

```bash
# Check queue worker status
docker compose ps queue

# View queue logs
docker compose logs queue -f

# Restart queue workers
docker compose restart queue
docker compose exec app php artisan queue:restart
```

**5. Assets Not Loading**:

```bash
# Rebuild assets
docker compose exec node npm run build

# Clear asset cache
docker compose exec app php artisan view:clear
docker compose exec app php artisan optimize:clear

# Link storage
docker compose exec app php artisan storage:link
```

**6. 500 Internal Server Error**:

```bash
# Check Laravel logs
docker compose exec app tail -f storage/logs/laravel.log

# Check PHP-FPM logs
docker compose logs app

# Check Nginx logs
docker compose logs web

# Enable debug mode temporarily
docker compose exec app php artisan env:set APP_DEBUG=true
```

### Performance Issues

**Slow Page Load**:

```bash
# Enable query logging
DB::enableQueryLog();
// ... your code
dd(DB::getQueryLog());

# Use Laravel Debugbar
composer require barryvdh/laravel-debugbar --dev

# Profile with Telescope
php artisan telescope:install
```

**High Memory Usage**:

```bash
# Check container resource usage
docker stats

# Increase PHP memory limit
# Edit docker/php/php.ini
memory_limit = 512M

# Restart containers
docker compose restart app
```

### Docker Issues

**Container Won't Start**:

```bash
# Check container logs
docker compose logs [service_name]

# Remove and rebuild
docker compose down -v
docker compose up -d --build

# Check port conflicts
lsof -i :80
lsof -i :3306
```

**Out of Disk Space**:

```bash
# Clean Docker system
docker system prune -a --volumes

# Remove unused images
docker image prune -a

# Check disk usage
docker system df
```

---

## ‚ùì FAQ

### General Questions

**Q: Can I use this in production?**  
A: Yes, the system is production-ready with enterprise-grade security and monitoring.

**Q: What are the minimum server requirements?**  
A: 4 CPU cores, 8GB RAM, 50GB SSD, Docker 24.0+, Docker Compose 2.20+

**Q: Is it free to use?**  
A: Yes, licensed under MIT License for both personal and commercial use.

### Technical Questions

**Q: How do I add a new AI provider?**  
A: Add credentials to `.env` and the system will automatically detect and use it with failover support.

**Q: Can I disable certain monitoring services?**  
A: Yes, comment out services in `docker-compose.yml` you don't need (e.g., Grafana, Prometheus).

**Q: How do I scale horizontally?**  
A: Use `docker compose up -d --scale queue=3` to run multiple queue workers.

**Q: Is there a demo available?**  
A: Install locally with Docker and use `php artisan db:seed` for demo data.

**Q: How do I backup to AWS S3?**  
A: Set `BACKUP_S3_ENABLED=true` and `BACKUP_S3_BUCKET=your-bucket` in `.env`.

---

## üìù Changelog

- Docker enterprise setup with 16 services
- PHP 8.4-FPM with custom extensions
- Nginx security headers hardening
- Prometheus + Grafana monitoring stack
- Complete documentation overhaul

### v1.2.5

- AI provider failover system
- Enhanced audit logging with hash chains
- Session management improvements

### v1.2.0

- 9 AI provider support
- Maintenance mode with bypass tokens
- Multi-channel notification system

### v1.0.0

- Initial release
- Filament v4 integration
- 5-level RBAC system
- Tamper-evident audit logging

---

## üìÑ License

This project is open-sourced software licensed under the [MIT License](LICENSE).

---

<div align="center">

**Built with ‚ù§Ô∏è using Laravel 12 + Filament v4**

[Report Bug](https://github.com/Halfirzzha/Creativetree-Production/issues) ¬∑ [Request Feature](https://github.com/Halfirzzha/Creativetree-Production/issues) ¬∑ [Documentation](https://github.com/Halfirzzha/Creativetree-Production#readme)

</div>
