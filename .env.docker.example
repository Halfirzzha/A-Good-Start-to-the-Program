# =============================================================================
# CREATIVE TREES - ENTERPRISE DOCKER ENVIRONMENT CONFIGURATION
# =============================================================================
# Version: 2.0.0
# Compliance: CIS Docker Benchmark v1.6, OWASP, NIST 800-53, SOC2, ISO 27001
#
# SECURITY NOTICE:
# - This file contains EXAMPLE values only
# - NEVER commit actual secrets to version control
# - Use strong, unique passwords generated with: openssl rand -base64 32
# - For production, consider Docker Secrets or external secret management
#
# USAGE:
#   1. Copy to .env: cp .env.docker.example .env
#   2. Generate secrets: Run the commands in [REQUIRED SECRETS] section
#   3. Review and customize all values
#   4. Start services: docker compose --profile dev up -d
# =============================================================================

# =============================================================================
# APPLICATION CORE
# =============================================================================
APP_NAME="Creative Trees"
APP_VERSION=2.0.0
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8080
APP_TIMEZONE=UTC
APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

# Laravel encryption key (Generate: php artisan key:generate)
APP_KEY=

# Maintenance mode driver
APP_MAINTENANCE_DRIVER=file

# =============================================================================
# DOCKER COMPOSE CONFIGURATION
# =============================================================================
# These variables control the Docker Compose orchestration

# --- Container User IDs (match host user for volume permissions) ---
# Run: id -u && id -g
DOCKER_UID=1000
DOCKER_GID=1000

# --- Port Mappings ---
WEB_PORT=8080
WEB_SSL_PORT=8443
VITE_PORT=5173
MAILPIT_WEB_PORT=8025
MAILPIT_SMTP_PORT=1025
PMA_PORT=8083
REDISINSIGHT_PORT=5540

# =============================================================================
# [REQUIRED SECRETS] - MUST BE CHANGED FOR ANY NON-LOCAL ENVIRONMENT
# =============================================================================
# Generate strong passwords using:
#   openssl rand -base64 32
#   or: php -r "echo bin2hex(random_bytes(24));"
#
# SECURITY: These defaults are for LOCAL DEVELOPMENT ONLY
# =============================================================================

# --- Database Credentials ---
# CRITICAL: Change these before ANY staging/production deployment
DB_PASSWORD=dev_password_change_me_2026
DB_ROOT_PASSWORD=root_password_change_me_2026

# --- Redis Authentication ---
# CRITICAL: Required for enterprise security
# Generate: openssl rand -base64 32 | tr -dc 'a-zA-Z0-9' | head -c 32
REDIS_PASSWORD=redis_password_change_me_2026
REDIS_COMMAND_SUFFIX=CT_SECURE_2026

# --- Mailpit Authentication ---
MAILPIT_USER=admin
MAILPIT_PASSWORD=mailpit_secure_password_2026

# --- phpMyAdmin Credentials ---
# IMPORTANT: Use separate credentials from DB root
# Generate: openssl rand -base64 32
PMA_USER=pma_admin
PMA_PASSWORD=pma_secure_password_2026
PMA_BLOWFISH_SECRET=your_32_char_blowfish_secret_here_change_me

# --- Monitoring Credentials ---
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=grafana_secure_password_2026

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=db_creativetrees
DB_USERNAME=app

# MySQL Performance Tuning
MYSQL_BUFFER_POOL=256M
MYSQL_MAX_CONNECTIONS=200

# MySQL Resource Limits (Docker)
MYSQL_CPU_LIMIT=2.0
MYSQL_MEMORY_LIMIT=1024M

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
# Client: 'predis' (pure PHP) or 'phpredis' (C extension, faster)
REDIS_CLIENT=predis
REDIS_SCHEME=tcp
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_USERNAME=
# REDIS_PASSWORD is defined in REQUIRED SECRETS section above

# Database separation for different concerns
REDIS_DB=0
REDIS_CACHE_DB=1
REDIS_SESSION_DB=2
REDIS_QUEUE_DB=3
REDIS_RATE_LIMIT_DB=4

# Redis connection settings
REDIS_PREFIX=ct:
REDIS_CACHE_CONNECTION=cache
REDIS_SESSION_CONNECTION=session
REDIS_RATE_LIMIT_CONNECTION=rate_limit
REDIS_QUEUE_CONNECTION=queue

# Connection pool settings
REDIS_TIMEOUT=2.0
REDIS_READ_TIMEOUT=2.0
REDIS_RETRY_INTERVAL=0
REDIS_PERSISTENT=false
REDIS_MAX_RETRIES=3
REDIS_BACKOFF_ALGORITHM=decorrelated_jitter
REDIS_BACKOFF_BASE=100
REDIS_BACKOFF_CAP=1000

# Redis memory limit (Docker)
REDIS_MAXMEMORY=256mb
REDIS_CPU_LIMIT=1.0
REDIS_MEMORY_LIMIT=512M

# =============================================================================
# SESSION & CACHE CONFIGURATION
# =============================================================================
SESSION_DRIVER=redis
SESSION_CONNECTION=session
SESSION_LIFETIME=120
SESSION_ENCRYPT=true
SESSION_PATH=/
SESSION_DOMAIN=null

CACHE_STORE=redis
CACHE_LIMITER=rate_limit
CACHE_PREFIX=ct-cache

# =============================================================================
# QUEUE CONFIGURATION
# =============================================================================
QUEUE_CONNECTION=redis
QUEUE_AFTER_COMMIT=true

# Queue worker settings
QUEUE_NAMES=emails,notifications,default
QUEUE_SLEEP=3
QUEUE_TRIES=3
QUEUE_TIMEOUT=90
QUEUE_MAX_JOBS=1000
QUEUE_MAX_TIME=3600
QUEUE_MEMORY=128

# Queue worker resource limits (Docker)
QUEUE_CPU_LIMIT=1.0
QUEUE_MEMORY_LIMIT=512M

# =============================================================================
# MAIL CONFIGURATION
# =============================================================================
# Development: Use mailpit (SMTP testing)
# Production: Configure real SMTP server
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="noreply@creativetrees.local"
MAIL_FROM_NAME="${APP_NAME}"

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

# =============================================================================
# PHP-FPM CONFIGURATION
# =============================================================================
PHP_FPM_MAX_CHILDREN=50
PHP_FPM_START_SERVERS=5
PHP_FPM_MIN_SPARE=5
PHP_FPM_MAX_SPARE=35

# App container resource limits (Docker)
APP_CPU_LIMIT=2.0
APP_MEMORY_LIMIT=1024M
APP_CPU_RESERVE=0.5
APP_MEMORY_RESERVE=256M

# =============================================================================
# NGINX CONFIGURATION
# =============================================================================
NGINX_WORKERS=auto
NGINX_CONNECTIONS=1024
NGINX_CPU_LIMIT=1.0
NGINX_MEMORY_LIMIT=256M

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
BCRYPT_ROUNDS=12

# Account security
SECURITY_ENFORCE_ACCOUNT_STATUS=true
SECURITY_ENFORCE_SESSION_STAMP=true
SECURITY_DEVELOPER_BYPASS_VALIDATIONS=true
SECURITY_DEVELOPER_ROLE=developer
SECURITY_SUPERADMIN_ROLE=super_admin

# Login protection
SECURITY_LOCKOUT_ATTEMPTS=5
SECURITY_LOCKOUT_MINUTES=15

# Password policy (NIST 800-63B compliant)
SECURITY_PASSWORD_HISTORY=5
SECURITY_PASSWORD_MIN_LENGTH=12
SECURITY_PASSWORD_MAX_LENGTH=128
SECURITY_PASSWORD_REQUIRE_MIXED=true
SECURITY_PASSWORD_REQUIRE_LETTER=true
SECURITY_PASSWORD_REQUIRE_NUMBERS=true
SECURITY_PASSWORD_REQUIRE_SYMBOLS=true
SECURITY_PASSWORD_REQUIRE_UNCOMPROMISED=true
SECURITY_PASSWORD_UNCOMPROMISED_THRESHOLD=0
SECURITY_PASSWORD_EXPIRY_DAYS=90
SECURITY_PASSWORD_EXPIRY_NOTIFY_DAYS=7
SECURITY_PASSWORD_AUTO_RESET=true

# Invitation security
SECURITY_INVITATION_EXPIRES_DAYS=5

# Alert configuration
SECURITY_ALERT_ENABLED=true
SECURITY_ALERT_LOG_CHANNEL=security
SECURITY_ALERT_EMAILS=
SECURITY_ALERT_IN_APP=true
SECURITY_ALERT_ROLES=developer,super_admin,admin

# Threat detection
SECURITY_THREAT_ENABLED=true
SECURITY_THREAT_AGGRESSIVE=true
SECURITY_THREAT_CACHE_STORE=rate_limit
SECURITY_RISK_THRESHOLD=8
SECURITY_RISK_DECAY_MINUTES=30
SECURITY_BURST_REQUESTS=90
SECURITY_BURST_WINDOW_SECONDS=60

# Threat scoring
SECURITY_ADMIN_PATH_BONUS=3
SECURITY_AUTH_PATH_BONUS=3
SECURITY_METHOD_POINTS=6
SECURITY_MISSING_UA_POINTS=3
SECURITY_SHORT_UA_POINTS=1
SECURITY_UA_PATTERN_POINTS=6
SECURITY_MAX_FORWARDED_FOR=3
SECURITY_FORWARDED_FOR_POINTS=2
SECURITY_MAX_QUERY_LENGTH=1600
SECURITY_QUERY_LENGTH_POINTS=2
SECURITY_MAX_PAYLOAD_KB=256
SECURITY_PAYLOAD_SIZE_POINTS=3
SECURITY_PATH_PATTERN_POINTS=5
SECURITY_PAYLOAD_PATTERN_POINTS=5

# Auto-blocking
SECURITY_AUTO_BLOCK=true
SECURITY_USER_BLOCK_MINUTES=90
SECURITY_IP_BLOCK_MINUTES=45

# =============================================================================
# AUDIT LOGGING CONFIGURATION
# =============================================================================
AUDIT_LOG_ENABLED=true
AUDIT_LOG_ADMIN_PATH=admin
AUDIT_LOG_ADMIN_ALL=true
AUDIT_LOG_METHODS=POST,PUT,PATCH,DELETE
AUDIT_CACHE_STORE=redis
AUDIT_LAST_SEEN_TTL=300
AUDIT_LOG_ERRORS=true
AUDIT_ERROR_MIN_STATUS=400
AUDIT_VERIFY_CHUNK=500
AUDIT_REHASH_CHUNK=500

# Audit signature (enable for tamper-evident logging)
# Generate: openssl rand -base64 64
AUDIT_SIGNATURE_ENABLED=false
AUDIT_SIGNATURE_SECRET=
AUDIT_SIGNATURE_ALGO=sha256

# =============================================================================
# OBSERVABILITY CONFIGURATION
# =============================================================================
OBSERVABILITY_SLOW_REQUEST_MS=800
OBSERVABILITY_SLOW_QUERY_MS=500
OBSERVABILITY_LOG_QUERY_BINDINGS=false

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_RETENTION_DAYS=7
BACKUP_DB_USER=root
BACKUP_DB_PASSWORD=${DB_ROOT_PASSWORD}

# =============================================================================
# EXTERNAL SERVICES (Optional)
# =============================================================================
# AWS S3
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

# Google Drive
GOOGLE_DRIVE_ROOT=Creative-Trees-System
GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON=
GOOGLE_DRIVE_CLIENT_ID=
GOOGLE_DRIVE_CLIENT_SECRET=
GOOGLE_DRIVE_REFRESH_TOKEN=
GOOGLE_DRIVE_TEAM_DRIVE_ID=
GOOGLE_DRIVE_SHARED_FOLDER_ID=

# =============================================================================
# VITE / FRONTEND
# =============================================================================
VITE_APP_NAME="${APP_NAME}"

# =============================================================================
# END OF CONFIGURATION
# =============================================================================
#
# CHECKLIST BEFORE STAGING/PRODUCTION:
# [ ] All passwords changed from defaults
# [ ] APP_DEBUG=false
# [ ] APP_ENV=production (or staging)
# [ ] SESSION_ENCRYPT=true
# [ ] SECURITY_DEVELOPER_BYPASS_VALIDATIONS=false
# [ ] AUDIT_SIGNATURE_ENABLED=true with strong secret
# [ ] Review all resource limits for your infrastructure
# [ ] Configure real MAIL_* settings
# [ ] Remove or secure tools profile access
# =============================================================================

